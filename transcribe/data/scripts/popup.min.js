var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(b){return b.raw=b};$jscomp.createTemplateTagFirstArgWithRaw=function(b,c){b.raw=c;return b};
var dataTbl,currentFileID=0,currentFileData,loadingConfirmBtn,loadingSub,loadingTitle,isConnected=!1,isConnecting=!0,firstLaunch=!0,statusTxt,overlay,not_connected='<i>Couldn\'t connect to controller <u id="reconnect">reconnect?</u></i>',connecting="<i>connecting to controller please wait...</i>",connected="<i>Connected to vScription Controller as </i>",not_running='<i>Controller not running. <u id="reconnect">reconnect?</u></i>',greenColor="#3e943c",orangeColor="#f78d2d",versionCheck="vCheck-",welcomeName=
"welcome-",backend_url="data/parts/backend_request.php",files_api="../api/v1/files/",wsocket,jobPickerWindow;null===window.opener&&(window.location.href="/index.php");
$(document).ready(function(){function b(){if(!isConnected||isConnecting)isConnecting=!0,e(connecting),wsocket=new WebSocket("ws://localhost:8001"),wsocket.onopen=c,wsocket.onmessage=n,wsocket.onerror=onerror,wsocket.onclose=p}function c(){isConnected=!0;isConnecting=!1;e(connected,!0)}function p(){isConnecting=isConnected=!1;firstLaunch?(firstLaunch=!1,e(not_running)):e(not_connected)}function n(a){a=a.data.toString();switch(a){case "play":k(!0);break;case "pause":k(!1);break;case "rw":AblePlayerInstances[0].handleRewind();
break;case "ff":AblePlayerInstances[0].handleFastForward();break;default:a.substring(0,7)===versionCheck?q(a.substring(7),r):a.substring(0,8)}}function k(a){""!==AblePlayerInstances[0].media.src&&(a?AblePlayerInstances[0].playMedia():AblePlayerInstances[0].pauseMedia())}function l(a){var c=function(){alert("Error Saving Job. Please contact support - ${data}\n We will attempt to save the text contents to your clipboard if there is any");tinyMCE.activeEditor.selection.select(tinyMCE.activeEditor.getBody());
tinyMCE.activeEditor.execCommand("Copy");g();h.style.display="none"},b=function(a){var b=Math.floor(AblePlayerInstances[0].seekBar.position).toString();d.append("reqcode",205);d.append("file_id",currentFileID);d.append("jobID",a.job_id);d.append("jobElapsedTimeSecs",b);d.append("jobAuthorName",a.file_author);d.append("jobFileName",a.origFilename);d.append("tempFilename",a.tempFilename);$fmtOrigDateDic=moment(a.file_date_dict).format("yyyy-MM-D");d.append("jobDateDic",$fmtOrigDateDic);d.append("jobStatus",
f);fetch(backend_url,{method:"POST",body:d}).then(function(a){a.text().then(function(b){console.log(b);console.log(a);a.ok?(b={mailtype:10,usertype:2},3===f&&$.post("data/parts/backend_request.php",{reqcode:80,args:JSON.stringify(b)}).done(function(a){}),g(),2===f?(loadingTitle.text("Done"),loadingSub.text("Job "+e+" suspended")):3===f?(loadingTitle.text("Done"),loadingSub.text("Job "+e+" marked as complete")):(loadingTitle.text("Done"),loadingSub.text("Job "+e+" updated successfully")),loadingConfirmBtn.css("display",
"")):c()})})},d=new FormData,e=$(".jobNo").html().trim(),f=5;a||(f=2);loadingSub.text("Saving "+e+" data");loadingTitle.text("Please wait..");loadingConfirmBtn.css("display","none");h.style.display="block";$.ajax({type:"GET",url:files_api+currentFileID,processData:!1,success:function(a){0!=a.length?b(a[0]):c()},error:function(a){$.confirm({title:"Error",content:a.responseJSON.msg,buttons:{confirm:{btnClass:"btn-red",action:function(){c();return!0}}}})}})}function t(){var a=2;0===currentFileData.job_status&&
(a=0);$.post("data/parts/backend_request.php",{reqcode:16,args:JSON.stringify({file_id:currentFileID,new_status:a})}).done(function(a){});g()}function g(){$(".title-default-text").css("display","inline-block");$(".title-text-holder").css("display","none");currentFileID=0;u();switchUI(!1)}function u(){AblePlayerInstances[0].media.src.split("/").pop();AblePlayerInstances[0].seekTo(0);AblePlayerInstances[0].media.pause();setTimeout(function(){AblePlayerInstances[0].media.removeAttribute("src");AblePlayerInstances[0].media.load()},
300)}function v(){$.confirm({title:"Discard Form?",content:"Are you sure do you want to discard current job?",buttons:{confirm:{btnClass:"btn-red",action:function(){t();return!0}},cancel:function(){}}})}function q(a,b){$.ajax({url:baseURL+"LatestVersion.txt",success:function(c){console.log("latestversion: "+c);b(c.split("-")[0].trim(),a)}})}function r(a,b){a>b?m(!0,a):m(!1,a)}function m(a,b){a?($("#updated_version_bar span").html(b),$("#updated_version_bar a").attr("href","controller.php"),$("#updated_version_bar").slideDown("normal",
"easeInOutBack")):$("#updated_version_bar").slideUp()}$(".overlay").css("display","");$(".loaded").css("display","none");new mdc.ripple.MDCRipple(document.querySelector("#saveBtn"));new mdc.ripple.MDCRipple(document.querySelector("#suspendBtn"));new mdc.ripple.MDCRipple(document.querySelector("#discardBtn"));new mdc.ripple.MDCRipple(document.querySelector("#loadBtn"));new mdc.ripple.MDCRipple(document.querySelector("#loadingConfirm"));window.addEventListener("load",b,!1);statusTxt=$("#statusTxt");
var e=function(a,c){c=void 0===c?!1:c;statusTxt.html(a);switch(c){case !0:statusTxt.css("color",greenColor);break;case !1:statusTxt.css("color",orangeColor),$("#reconnect").on("click",function(a){b()})}};$.ajaxSetup({cache:!1});var h=document.getElementById("modalLoading");loadingConfirmBtn=$("#loadingConfirm");loadingSub=$("#modalLoading .modal-content p i");loadingTitle=$("#modalLoading .modal-content h2");loadingConfirmBtn.on("click",function(){h.style.display="none"});$("#loadBtn").on("click",
function(){jobPickerWindow=window.open("job_picker.php","modalPicker","toolbar=yes,scrollbars=yes,resizable=yes,top=500,left=500,width=1000,height=500")});$("#switchBackBtn").click(function(){postToParent()});$("#discardBtn").click(function(){v()});$("#saveBtn").click(function(){l(!0)});$("#suspendBtn").click(function(){l(!1)});$.post(backend_url,{reqcode:204}).done(function(a){console.log("session saved id is "+a);a?"0"===a?switchUI(!1):loadID(a):switchUI(!1)})});
function loadID(b){console.log("ID to load: "+b);$(".overlay").css("display","");jobPickerWindow&&jobPickerWindow.close();$.post("data/parts/backend_request.php",{reqcode:7,args:JSON.stringify({file_id:b})}).done(function(b){b?loadIntoPlayer(b):(switchUI(!1),$.confirm({title:"Error",content:"Job doesn't exist or you don't have permission to access it.",buttons:{confirm:{btnClass:"btn-green",text:"ok"}}}))})}
function loadIntoPlayer(b){var c=JSON.parse(b);currentFileData=c;currentFileID=c.file_id;$("#jobNo").html(c.job_id);$("#author").html(c.file_author);$("#jobType").html(c.file_work_type);AblePlayerInstances[0].media.src=audioTempFolder+c.tempFilename;AblePlayer.prototype.onMediaNewSourceLoad=function(){2===c.job_status||1===c.job_status?AblePlayerInstances[0].seekTo(c.last_audio_position-rewindAmountOnPause):AblePlayerInstances[0].seekTo(0);switchUI(!0)};AblePlayerInstances[0].onMediaPause=function(){0<
AblePlayerInstances[0].seekBar.position-rewindAmountOnPause?AblePlayerInstances[0].seekTo(AblePlayerInstances[0].seekBar.position-rewindAmountOnPause):AblePlayerInstances[0].seekTo(0)}}
function switchUI(b){b?($(".title-default-text").css("display","none"),$(".title-text-holder").css("display",""),$(".loaded").css("display",""),$(".not-loaded").css("display","none")):($(".title-default-text").css("display","inline-block"),$(".title-text-holder").css("display","none"),$(".loaded").css("display","none"),$(".not-loaded").css("display",""));$(".overlay").css("display","none")}
function postToParent(){null!==window.opener?window.opener.switchBack():(window.open("transcribe.php","_blank"),close())};
