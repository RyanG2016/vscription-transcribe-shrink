var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,c){a.raw=c;return a};
var dataTbl,currentFileID=0,currentFileData,loadingConfirmBtn,loadingSub,loadingTitle,isConnected=!1,isConnecting=!0,firstLaunch=!0,statusTxt,overlay,not_connected='<i>Couldn\'t connect to controller <u id="reconnect">reconnect?</u></i>',connecting="<i>connecting to controller please wait...</i>",connected="<i>Connected to vScription Controller</i>",not_running='<i>Controller not running. <u id="reconnect">reconnect?</u></i>',greenColor="#3e943c",orangeColor="#f78d2d",versionCheck="vCheck-",welcomeName=
"welcome-",backend_url="data/parts/backend_request.php",files_api="../api/v1/files/",wsocket,jobPickerWindow;null===window.opener&&(window.location.href="/index.php");
$(document).ready(function(){function a(){if(!isConnected||isConnecting)isConnecting=!0,d(connecting),wsocket=new WebSocket("ws://localhost:8001"),wsocket.onopen=c,wsocket.onmessage=m,wsocket.onerror=onerror,wsocket.onclose=n}function c(){isConnected=!0;isConnecting=!1;d(connected,!0)}function n(){isConnecting=isConnected=!1;firstLaunch?(firstLaunch=!1,d(not_running)):d(not_connected)}function m(b){b=b.data.toString();switch(b){case "play":g(!0);break;case "pause":g(!1);break;case "rw":AblePlayerInstances[0].handleRewind();
break;case "ff":AblePlayerInstances[0].handleFastForward();break;default:b.substring(0,7)===versionCheck?p(b.substring(7),q):b.substring(0,8)}}function g(b){""!==AblePlayerInstances[0].media.src&&(b?AblePlayerInstances[0].playMedia():AblePlayerInstances[0].pauseMedia())}function h(b){var a=new FormData,e=$(".jobNo").html().trim(),c=5;b||(c=2);loadingSub.text("Saving "+e+" data");loadingTitle.text("Please wait..");loadingConfirmBtn.css("display","none");f.style.display="block";b=Math.floor(AblePlayerInstances[0].seekBar.position).toString();
a.append("audio_length",Math.round(AblePlayerInstances[0].seekBar.duration));a.append("last_audio_position",b);a.append("file_status",c);a.append("set_role",3);b=currentFileID;k()&&$.ajax({type:"POST",url:files_api+b,data:a,processData:!1,contentType:!1,success:function(b){2===c?(loadingTitle.text("Done"),loadingSub.text("Job "+e+" suspended")):3===c?(loadingTitle.text("Done"),loadingSub.text("Job "+e+" marked as complete")):(loadingTitle.text("Done"),loadingSub.text("Job "+e+" updated successfully"));
loadingConfirmBtn.css("display","")},error:function(b){alert("Error Saving Job. Please contact support - ${data}\n We will attempt to save the text contents to your clipboard if there is any");tinyMCE.activeEditor.selection.select(tinyMCE.activeEditor.getBody());tinyMCE.activeEditor.execCommand("Copy");f.style.display="none"}})}function r(){var b=2;0===currentFileData.job_status&&(b=0);$.post("data/parts/backend_request.php",{reqcode:16,args:JSON.stringify({file_id:currentFileID,new_status:b})}).done(function(b){});
k()}function k(){$(".title-default-text").css("display","inline-block");$(".title-text-holder").css("display","none");currentFileID=0;switchUI(!1);AblePlayerInstances[0].media.src.split("/").pop();AblePlayerInstances[0].seekTo(0);AblePlayerInstances[0].media.pause();AblePlayerInstances[0].media.removeAttribute("src");AblePlayerInstances[0].media.load();return!0}function t(){$.confirm({title:"Discard Form?",content:"Are you sure do you want to discard current job?",buttons:{confirm:{btnClass:"btn-red",
action:function(){r();return!0}},cancel:function(){}}})}function p(b,a){$.ajax({url:baseURL+"LatestVersion.txt",success:function(c){console.log("latestversion: "+c);a(c.split("-")[0].trim(),b)}})}function q(b,a){b>a?l(!0,b):l(!1,b)}function l(a,c){a?($("#updated_version_bar span").html(c),$("#updated_version_bar a").attr("href","controller.php"),$("#updated_version_bar").slideDown("normal","easeInOutBack")):$("#updated_version_bar").slideUp()}$(".overlay").css("display","");$(".loaded").css("display",
"none");new mdc.ripple.MDCRipple(document.querySelector("#saveBtn"));new mdc.ripple.MDCRipple(document.querySelector("#suspendBtn"));new mdc.ripple.MDCRipple(document.querySelector("#discardBtn"));new mdc.ripple.MDCRipple(document.querySelector("#loadBtn"));new mdc.ripple.MDCRipple(document.querySelector("#loadingConfirm"));window.addEventListener("load",a,!1);statusTxt=$("#statusTxt");var d=function(b,c){c=void 0===c?!1:c;statusTxt.html(b);switch(c){case !0:statusTxt.css("color",greenColor);break;
case !1:statusTxt.css("color",orangeColor),$("#reconnect").on("click",function(b){a()})}};$.ajaxSetup({cache:!1});var f=document.getElementById("modalLoading");loadingConfirmBtn=$("#loadingConfirm");loadingSub=$("#modalLoading .modal-content p i");loadingTitle=$("#modalLoading .modal-content h2");loadingConfirmBtn.on("click",function(){f.style.display="none"});$("#loadBtn").on("click",function(){jobPickerWindow=window.open("job_picker.php","modalPicker","toolbar=yes,scrollbars=yes,resizable=yes,top=500,left=500,width=1000,height=500")});
$("#switchBackBtn").click(function(){postToParent()});$("#discardBtn").click(function(){t()});$("#saveBtn").click(function(){h(!0)});$("#suspendBtn").click(function(){h(!1)});$.post(backend_url,{reqcode:204}).done(function(a){a?"0"===a?switchUI(!1):loadID(a):switchUI(!1)})});
function loadID(a){$(".overlay").css("display","");jobPickerWindow&&jobPickerWindow.close();$.get(files_api+a+"?tr",{}).done(function(a){a?loadIntoPlayer(a):(switchUI(!1),$.confirm({title:"Error",content:"Job doesn't exist or you don't have permission to access it.",buttons:{confirm:{btnClass:"btn-green",text:"ok"}}}))})}
function loadIntoPlayer(a){currentFileData=a=JSON.parse(a);currentFileID=a.file_id;$("#jobNo").html(a.job_id);$("#author").html(a.file_author);$("#jobType").html(a.file_work_type);AblePlayerInstances[0].media.src=audioTempFolder+a.tmp_name;2==a.job_status||1==a.job_status?($("#audio1").attr("data-start-time",a.last_audio_position-rewindAmountOnPause),AblePlayerInstances[0].media.currentTime=a.last_audio_position-rewindAmountOnPause):($("#audio1").attr("data-start-time",0),AblePlayerInstances[0].media.currentTime=
0);AblePlayerInstances[0].media.load();switchUI(!0);AblePlayerInstances[0].onMediaPause=function(){0<AblePlayerInstances[0].seekBar.position-rewindAmountOnPause?AblePlayerInstances[0].seekTo(AblePlayerInstances[0].seekBar.position-rewindAmountOnPause):AblePlayerInstances[0].seekTo(0)}}
function switchUI(a){a?($(".title-default-text").css("display","none"),$(".title-text-holder").css("display",""),$(".loaded").css("display",""),$(".not-loaded").css("display","none")):($(".title-default-text").css("display","inline-block"),$(".title-text-holder").css("display","none"),$(".loaded").css("display","none"),$(".not-loaded").css("display",""));$(".overlay").css("display","none")}
function postToParent(){null!==window.opener?window.opener.switchBack():(window.open("transcribe.php","_blank"),close())};
