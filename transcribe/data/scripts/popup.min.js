var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(c){return c.raw=c};$jscomp.createTemplateTagFirstArgWithRaw=function(c,a){c.raw=a;return c};
var dataTbl,currentFileID=0,currentFileData,loadingConfirmBtn,loadingSub,loadingTitle,isConnected=!1,isConnecting=!0,firstLaunch=!0,statusTxt,overlay,not_connected='<i>Couldn\'t connect to controller <u id="reconnect">reconnect?</u></i>',connecting="<i>connecting to controller please wait...</i>",connected="<i>Connected to vScription Controller</i>",not_running='<i>Controller not running. <u id="reconnect">reconnect?</u></i>',greenColor="#3e943c",orangeColor="#f78d2d",versionCheck="vCheck-",welcomeName=
"welcome-",backend_url="data/parts/backend_request.php",files_api="../api/v1/files/",wsocket,jobPickerWindow;null===window.opener&&(window.location.href="/index.php");
$(document).ready(function(){function c(){if(!isConnected||isConnecting)isConnecting=!0,d(connecting),wsocket=new WebSocket("ws://localhost:8001"),wsocket.onopen=a,wsocket.onmessage=l,wsocket.onerror=onerror,wsocket.onclose=m}function a(){isConnected=!0;isConnecting=!1;d(connected,!0)}function m(){isConnecting=isConnected=!1;firstLaunch?(firstLaunch=!1,d(not_running)):d(not_connected)}function l(b){b=b.data.toString();switch(b){case "play":f(!0);break;case "pause":f(!1);break;case "rw":AblePlayerInstances[0].handleRewind();
break;case "ff":AblePlayerInstances[0].handleFastForward();break;default:b.substring(0,7)===versionCheck?n(b.substring(7),p):b.substring(0,8)}}function f(b){""!==AblePlayerInstances[0].media.src&&(b?AblePlayerInstances[0].playMedia():AblePlayerInstances[0].pauseMedia())}function g(b){var a=new FormData,c=$(".jobNo").html().trim(),d=5;b||(d=2);loadingSub.text("Saving "+c+" data");loadingTitle.text("Please wait..");loadingConfirmBtn.css("display","none");e.style.display="block";b=Math.floor(AblePlayerInstances[0].seekBar.position).toString();
a.append("audio_length",Math.round(AblePlayerInstances[0].seekBar.duration));a.append("last_audio_position",b);a.append("file_status",d);a.append("set_role",3);b=currentFileID;h()&&$.ajax({type:"POST",url:files_api+b,data:a,processData:!1,contentType:!1,success:function(b){2===d?(loadingTitle.text("Done"),loadingSub.text("Job "+c+" suspended")):3===d?(loadingTitle.text("Done"),loadingSub.text("Job "+c+" marked as complete")):(loadingTitle.text("Done"),loadingSub.text("Job "+c+" updated successfully"));
loadingConfirmBtn.css("display","")},error:function(b){alert("Error Saving Job. Please contact support - ${data}\n We will attempt to save the text contents to your clipboard if there is any");tinyMCE.activeEditor.selection.select(tinyMCE.activeEditor.getBody());tinyMCE.activeEditor.execCommand("Copy");e.style.display="none"}})}function q(){var b=2;0===currentFileData.job_status&&(b=0);$.post("data/parts/backend_request.php",{reqcode:16,args:JSON.stringify({file_id:currentFileID,new_status:b})}).done(function(b){});
h()}function h(){$(".title-default-text").css("display","inline-block");$(".title-text-holder").css("display","none");currentFileID=0;switchUI(!1);AblePlayerInstances[0].media.src.split("/").pop();AblePlayerInstances[0].seekTo(0);AblePlayerInstances[0].media.pause();AblePlayerInstances[0].media.removeAttribute("src");AblePlayerInstances[0].media.load();return!0}function r(){$.confirm({title:"Discard Form?",content:"Are you sure do you want to discard current job?",buttons:{confirm:{btnClass:"btn-red",
action:function(){q();return!0}},cancel:function(){}}})}function n(b,a){$.ajax({url:baseURL+"LatestVersion.txt",success:function(c){console.log("latestversion: "+c);a(c.split("-")[0].trim(),b)}})}function p(b,a){b>a?k(!0,b):k(!1,b)}function k(b,a){b?($("#updated_version_bar span").html(a),$("#updated_version_bar a").attr("href","controller.php"),$("#updated_version_bar").slideDown("normal","easeInOutBack")):$("#updated_version_bar").slideUp()}$(".overlay").css("display","");$(".loaded").css("display",
"none");new mdc.ripple.MDCRipple(document.querySelector("#saveBtn"));new mdc.ripple.MDCRipple(document.querySelector("#suspendBtn"));new mdc.ripple.MDCRipple(document.querySelector("#discardBtn"));new mdc.ripple.MDCRipple(document.querySelector("#loadBtn"));new mdc.ripple.MDCRipple(document.querySelector("#loadingConfirm"));window.addEventListener("load",c,!1);statusTxt=$("#statusTxt");var d=function(b,a){a=void 0===a?!1:a;statusTxt.html(b);switch(a){case !0:statusTxt.css("color",greenColor);break;
case !1:statusTxt.css("color",orangeColor),$("#reconnect").on("click",function(a){c()})}};$.ajaxSetup({cache:!1});var e=document.getElementById("modalLoading");loadingConfirmBtn=$("#loadingConfirm");loadingSub=$("#modalLoading .modal-content p i");loadingTitle=$("#modalLoading .modal-content h2");loadingConfirmBtn.on("click",function(){e.style.display="none"});$("#loadBtn").on("click",function(){jobPickerWindow=window.open("job_picker.php","modalPicker","toolbar=yes,scrollbars=yes,resizable=yes,top=500,left=500,width=1000,height=500")});
$("#switchBackBtn").click(function(){postToParent()});$("#discardBtn").click(function(){r()});$("#saveBtn").click(function(){g(!0)});$("#suspendBtn").click(function(){g(!1)});$.post(backend_url,{reqcode:204}).done(function(a){a?"0"===a?switchUI(!1):loadID(a):switchUI(!1)})});
function loadID(c){$(".overlay").css("display","");jobPickerWindow&&jobPickerWindow.close();$.get(files_api+c+"?tr",{}).done(function(a){a?loadIntoPlayer(a):(switchUI(!1),$.confirm({title:"Error",content:"Job doesn't exist or you don't have permission to access it.",buttons:{confirm:{btnClass:"btn-green",text:"ok"}}}))})}
function loadIntoPlayer(c){var a=JSON.parse(c);currentFileData=a;currentFileID=a.file_id;$("#jobNo").html(a.job_id);$("#author").html(a.file_author);$("#jobType").html(a.file_work_type);AblePlayerInstances[0].media.src=audioTempFolder+a.tmp_name;AblePlayer.prototype.onMediaNewSourceLoad=function(){2==a.job_status||1==a.job_status?(AblePlayerInstances[0].seekTo(a.last_audio_position-rewindAmountOnPause),setTimeout(function(){AblePlayerInstances[0].seekBar.setPosition(a.last_audio_position-rewindAmountOnPause)},
50)):AblePlayerInstances[0].seekTo(0);switchUI(!0)};AblePlayerInstances[0].onMediaPause=function(){0<AblePlayerInstances[0].seekBar.position-rewindAmountOnPause?AblePlayerInstances[0].seekTo(AblePlayerInstances[0].seekBar.position-rewindAmountOnPause):AblePlayerInstances[0].seekTo(0)}}
function switchUI(c){c?($(".title-default-text").css("display","none"),$(".title-text-holder").css("display",""),$(".loaded").css("display",""),$(".not-loaded").css("display","none")):($(".title-default-text").css("display","inline-block"),$(".title-text-holder").css("display","none"),$(".loaded").css("display","none"),$(".not-loaded").css("display",""));$(".overlay").css("display","none")}
function postToParent(){null!==window.opener?window.opener.switchBack():(window.open("transcribe.php","_blank"),close())};
