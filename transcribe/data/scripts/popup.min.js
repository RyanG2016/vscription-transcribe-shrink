var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(c){return c.raw=c};$jscomp.createTemplateTagFirstArgWithRaw=function(c,b){c.raw=b;return c};
var dataTbl,currentFileID=0,currentFileData,loadingConfirmBtn,loadingSub,loadingTitle,isConnected=!1,isConnecting=!0,firstLaunch=!0,statusTxt,overlay,not_connected='<i>Couldn\'t connect to controller <u id="reconnect">reconnect?</u></i>',connecting="<i>connecting to controller please wait...</i>",connected="<i>Connected to vScription Controller as </i>",not_running='<i>Controller not running. <u id="reconnect">reconnect?</u></i>',greenColor="#3e943c",orangeColor="#f78d2d",versionCheck="vCheck-",welcomeName=
"welcome-",backend_url="data/parts/backend_request.php",files_api="../api/v1/files/",wsocket,jobPickerWindow;null===window.opener&&(window.location.href="/index.php");
$(document).ready(function(){function c(){if(!isConnected||isConnecting)isConnecting=!0,e(connecting),wsocket=new WebSocket("ws://localhost:8001"),wsocket.onopen=b,wsocket.onmessage=m,wsocket.onerror=onerror,wsocket.onclose=n}function b(){isConnected=!0;isConnecting=!1;e(connected,!0)}function n(){isConnecting=isConnected=!1;firstLaunch?(firstLaunch=!1,e(not_running)):e(not_connected)}function m(a){a=a.data.toString();switch(a){case "play":g(!0);break;case "pause":g(!1);break;case "rw":AblePlayerInstances[0].handleRewind();
break;case "ff":AblePlayerInstances[0].handleFastForward();break;default:a.substring(0,7)===versionCheck?p(a.substring(7),q):a.substring(0,8)}}function g(a){""!==AblePlayerInstances[0].media.src&&(a?AblePlayerInstances[0].playMedia():AblePlayerInstances[0].pauseMedia())}function h(a){var d=new FormData,b=$(".jobNo").html().trim(),c=5;a||(c=2);loadingSub.text("Saving "+b+" data");loadingTitle.text("Please wait..");loadingConfirmBtn.css("display","none");f.style.display="block";a=Math.floor(AblePlayerInstances[0].seekBar.position).toString();
d.append("audio_length",Math.round(AblePlayerInstances[0].seekBar.duration));d.append("last_audio_position",a);d.append("file_status",c);d.append("set_role",3);a=currentFileID;k()&&$.ajax({type:"POST",url:files_api+a,data:d,processData:!1,contentType:!1,success:function(a){2===c?(loadingTitle.text("Done"),loadingSub.text("Job "+b+" suspended")):3===c?(loadingTitle.text("Done"),loadingSub.text("Job "+b+" marked as complete")):(loadingTitle.text("Done"),loadingSub.text("Job "+b+" updated successfully"));
loadingConfirmBtn.css("display","")},error:function(a){alert("Error Saving Job. Please contact support - ${data}\n We will attempt to save the text contents to your clipboard if there is any");tinyMCE.activeEditor.selection.select(tinyMCE.activeEditor.getBody());tinyMCE.activeEditor.execCommand("Copy");f.style.display="none"}})}function r(){var a=2;0===currentFileData.job_status&&(a=0);$.post("data/parts/backend_request.php",{reqcode:16,args:JSON.stringify({file_id:currentFileID,new_status:a})}).done(function(a){});
k()}function k(){$(".title-default-text").css("display","inline-block");$(".title-text-holder").css("display","none");currentFileID=0;switchUI(!1);AblePlayerInstances[0].media.src.split("/").pop();AblePlayerInstances[0].seekTo(0);AblePlayerInstances[0].media.pause();AblePlayerInstances[0].media.removeAttribute("src");AblePlayerInstances[0].media.load();return!0}function t(){$.confirm({title:"Discard Form?",content:"Are you sure do you want to discard current job?",buttons:{confirm:{btnClass:"btn-red",
action:function(){r();return!0}},cancel:function(){}}})}function p(a,b){$.ajax({url:baseURL+"LatestVersion.txt",success:function(c){console.log("latestversion: "+c);b(c.split("-")[0].trim(),a)}})}function q(a,b){a>b?l(!0,a):l(!1,a)}function l(a,b){a?($("#updated_version_bar span").html(b),$("#updated_version_bar a").attr("href","controller.php"),$("#updated_version_bar").slideDown("normal","easeInOutBack")):$("#updated_version_bar").slideUp()}$(".overlay").css("display","");$(".loaded").css("display",
"none");new mdc.ripple.MDCRipple(document.querySelector("#saveBtn"));new mdc.ripple.MDCRipple(document.querySelector("#suspendBtn"));new mdc.ripple.MDCRipple(document.querySelector("#discardBtn"));new mdc.ripple.MDCRipple(document.querySelector("#loadBtn"));new mdc.ripple.MDCRipple(document.querySelector("#loadingConfirm"));window.addEventListener("load",c,!1);statusTxt=$("#statusTxt");var e=function(a,b){b=void 0===b?!1:b;statusTxt.html(a);switch(b){case !0:statusTxt.css("color",greenColor);break;
case !1:statusTxt.css("color",orangeColor),$("#reconnect").on("click",function(a){c()})}};$.ajaxSetup({cache:!1});var f=document.getElementById("modalLoading");loadingConfirmBtn=$("#loadingConfirm");loadingSub=$("#modalLoading .modal-content p i");loadingTitle=$("#modalLoading .modal-content h2");loadingConfirmBtn.on("click",function(){f.style.display="none"});$("#loadBtn").on("click",function(){jobPickerWindow=window.open("job_picker.php","modalPicker","toolbar=yes,scrollbars=yes,resizable=yes,top=500,left=500,width=1000,height=500")});
$("#switchBackBtn").click(function(){postToParent()});$("#discardBtn").click(function(){t()});$("#saveBtn").click(function(){h(!0)});$("#suspendBtn").click(function(){h(!1)});$.post(backend_url,{reqcode:204}).done(function(a){a?"0"===a?switchUI(!1):loadID(a):switchUI(!1)})});
function loadID(c){$(".overlay").css("display","");jobPickerWindow&&jobPickerWindow.close();$.get(files_api+c+"?tr",{}).done(function(b){b?loadIntoPlayer(b):(switchUI(!1),$.confirm({title:"Error",content:"Job doesn't exist or you don't have permission to access it.",buttons:{confirm:{btnClass:"btn-green",text:"ok"}}}))})}
function loadIntoPlayer(c){var b=JSON.parse(c);currentFileData=b;currentFileID=b.file_id;$("#jobNo").html(b.job_id);$("#author").html(b.file_author);$("#jobType").html(b.file_work_type);AblePlayerInstances[0].media.src=audioTempFolder+b.tmp_name;AblePlayer.prototype.onMediaNewSourceLoad=function(){2===b.job_status||1===b.job_status?AblePlayerInstances[0].seekTo(b.last_audio_position-rewindAmountOnPause):AblePlayerInstances[0].seekTo(0);switchUI(!0)};AblePlayerInstances[0].onMediaPause=function(){0<
AblePlayerInstances[0].seekBar.position-rewindAmountOnPause?AblePlayerInstances[0].seekTo(AblePlayerInstances[0].seekBar.position-rewindAmountOnPause):AblePlayerInstances[0].seekTo(0)}}
function switchUI(c){c?($(".title-default-text").css("display","none"),$(".title-text-holder").css("display",""),$(".loaded").css("display",""),$(".not-loaded").css("display","none")):($(".title-default-text").css("display","inline-block"),$(".title-text-holder").css("display","none"),$(".loaded").css("display","none"),$(".not-loaded").css("display",""));$(".overlay").css("display","none")}
function postToParent(){null!==window.opener?window.opener.switchBack():(window.open("transcribe.php","_blank"),close())};
