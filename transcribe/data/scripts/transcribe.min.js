var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,e,d){b instanceof String&&(b=String(b));for(var g=b.length,f=0;f<g;f++){var h=b[f];if(e.call(d,h,f,b))return{i:f,v:h}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,e,d){if(b==Array.prototype||b==Object.prototype)return b;b[e]=d.value;return b};$jscomp.getGlobal=function(b){b=["object"==typeof globalThis&&globalThis,b,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var e=0;e<b.length;++e){var d=b[e];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(b,e){var d=$jscomp.propertyToPolyfillSymbol[e];if(null==d)return b[e];d=b[d];return void 0!==d?d:b[e]};
$jscomp.polyfill=function(b,e,d,g){e&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(b,e,d,g):$jscomp.polyfillUnisolated(b,e,d,g))};$jscomp.polyfillUnisolated=function(b,e,d,g){d=$jscomp.global;b=b.split(".");for(g=0;g<b.length-1;g++){var f=b[g];if(!(f in d))return;d=d[f]}b=b[b.length-1];g=d[b];e=e(g);e!=g&&null!=e&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:e})};
$jscomp.polyfillIsolated=function(b,e,d,g){var f=b.split(".");b=1===f.length;g=f[0];g=!b&&g in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var h=0;h<f.length-1;h++){var l=f[h];if(!(l in g))return;g=g[l]}f=f[f.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?g[f]:null;e=e(d);null!=e&&(b?$jscomp.defineProperty($jscomp.polyfills,f,{configurable:!0,writable:!0,value:e}):e!==d&&($jscomp.propertyToPolyfillSymbol[f]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(f):$jscomp.POLYFILL_PREFIX+f,f=
$jscomp.propertyToPolyfillSymbol[f],$jscomp.defineProperty(g,f,{configurable:!0,writable:!0,value:e})))};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,d){return $jscomp.findInternal(this,b,d).v}},"es6","es3");
var g_fileName,dataTbl,currentFileID=0,currentFileData,loadingConfirmBtn,loadingSub,loadingTitle,isConnected=!1,isConnecting=!0,firstLaunch=!0,statusTxt,not_connected='<i>Couldn\'t connect to controller <u id="reconnect">reconnect?</u> <span class=\'download-controller\' id="downloadController">or download here</span></i>',connecting="<i>connecting to controller please wait...</i>",connected="<i>Connected to vScription Controller</i>",not_running='<i>Controller not running. <u id="reconnect">reconnect?</u> <span class=\'download-controller\' id="downloadController">or download here</span></i>',
greenColor="#3e943c",orangeColor="#d34038",versionCheck="vCheck-",welcomeName="welcome-",compactViewWindow,jobsDT,jobsDTRef,demoExpandArrow,demoFields,loadingOv;
$(document).ready(function(){function b(){if(!isConnected||isConnecting)isConnecting=!0,p(connecting),k=new WebSocket("ws://localhost:8001"),k.onopen=e,k.onmessage=g,k.onerror=onerror,k.onclose=d}function e(){isConnected=!0;isConnecting=!1;p(connected,!0)}function d(){isConnecting=isConnected=!1;firstLaunch?(firstLaunch=!1,p(not_running)):p(not_connected)}function g(a){a=a.data.toString();switch(a){case "play":f(!0);break;case "pause":f(!1);break;case "rw":AblePlayerInstances[0].handleRewind();break;
case "ff":AblePlayerInstances[0].handleFastForward();break;default:a.substring(0,7)===versionCheck?w(a.substring(7),x):a.substring(0,8)}}function f(a){""!==AblePlayerInstances[0].media.src&&(a?AblePlayerInstances[0].playMedia():AblePlayerInstances[0].pauseMedia())}function h(){$.confirm({title:"Discard Form?",content:"Are you sure do you want to discard current data?",buttons:{confirm:{btnClass:"btn-red",action:function(){r();return!0}},cancel:function(){}}})}function l(){$.post("data/parts/backend_request.php",
{reqcode:203,args:JSON.stringify({fileID:currentFileID})}).done(function(a){isConnected&&(isConnecting=isConnected=!1,k.send("transcribe client disconnecting.."));0!==currentFileID&&r();AblePlayerInstances[0].pauseMedia();compactViewWindow=window.open("popup.php","modalPlayer","toolbar=yes,scrollbars=yes,resizable=yes,top=500,left=500,width=530,height=262")})}function y(){$.confirm({title:"Discard?",content:"Are you sure do you want to discard current text changes and switch to compact view?",buttons:{confirm:{btnClass:"btn-red",
action:function(){l();return!0}},cancel:function(){return!0}}})}function r(){var a=2;0===currentFileData.job_status&&(a=0);$.post("data/parts/backend_request.php",{reqcode:16,args:JSON.stringify({file_id:currentFileID,new_status:a})}).done(function(a){});t()}function t(){document.getElementById("date").value="";document.getElementById("jobNo").value="";document.getElementById("comments").value="";document.getElementById("jobType").value="";document.getElementById("authorName").value="";document.getElementById("user_field_1").value=
"";document.getElementById("user_field_2").value="";document.getElementById("user_field_3").value="";document.getElementById("report").value="";$("#date").garlic("destroy");m.garlic("destroy");$("#jobType").attr("disabled","");$("#jobNo").garlic("destroy");$("#comments").garlic("destroy");$("#comments").attr("disabled","");$("#authorName").garlic("destroy");$("#user_field_1").garlic("destroy");$("#user_field_2").garlic("destroy");$("#user_field_3").garlic("destroy");$("#report").garlic("destroy");
document.title="Form";tinyMCE.activeEditor.setContent("");currentFileID=0;$("#saveBtn").attr("disabled","disabled");$("#suspendBtn").attr("disabled","disabled");$("#discardBtn").attr("disabled","disabled");tinyMCE.activeEditor.setMode("readonly");var a=$("#loadBtn"),c=$("#completeBtn");AblePlayerInstances[0].media.src.split("/").pop();AblePlayerInstances[0].seekTo(0);AblePlayerInstances[0].media.pause();AblePlayerInstances[0].media.removeAttribute("src");AblePlayerInstances[0].seekBar.setPosition(0);
AblePlayerInstances[0].media.load();a.removeClass("noHover");a.html('<i class="fas fa-cloud-upload-alt"></i>&nbsp;Load');a.find("i").show();c.addClass("noHover");c.addClass("button");c.removeClass("button-green");return!0}function z(a){$.get("../api/v1/files/"+a+"?tr").done(function(a){a?A(a):(switchUI(!1),q(!1,"Loading transcribe.."),$.confirm({title:"Error",content:"Job doesn't exist or you don't have permission to access it.",buttons:{confirm:{btnClass:"btn-green",text:"ok"}}}))})}function B(a){var c=
document.createElement("textarea");c.innerHTML=a;return c.value}function A(a){var c=JSON.parse(a);currentFileData=c;currentFileID=c.file_id;null!==c.suspendedText&&0!==c.job_status&&(tinymce.get("report").setContent(B(c.suspendedText)),tinyMCE.activeEditor.selection.select(tinyMCE.activeEditor.getBody(),!0),tinyMCE.activeEditor.selection.collapse(!1));$("#jobNo").val(c.job_id);$("#authorName").val(c.file_author);$("#jobType").removeAttr("disabled");m.find("[value='"+c.file_work_type.toLowerCase().trim()+
"']").length||(a='<option value="'+c.file_work_type.toLowerCase().trim()+'">'+c.file_work_type+"</option>",m.html(m.html()+a));m.val(c.file_work_type.toLowerCase().trim());a=moment(c.file_date_dict).format("DD-MMM-YYYY hh:mm:ss a");$("#date").val(a);$("#comments").val(c.typist_comments);$("#file_comment").val(c.file_comment);$("#comments").removeAttr("disabled");$("#user_field_1").val(c.user_field_1);$("#user_field_2").val(c.user_field_2);$("#user_field_3").val(c.user_field_3);a=$("#loadBtn");$("#completeBtn");
AblePlayerInstances[0].media.src=audioTempFolder+c.tmp_name;a.addClass("noHover");a.text(c.job_id+" Loaded");a.find("i").hide();3==rl&&($("#saveBtn").removeAttr("disabled"),$("#suspendBtn").removeAttr("disabled"));$("#discardBtn").removeAttr("disabled");tinyMCE.activeEditor.setMode("design");AblePlayerInstances[0].onMediaNewSourceLoad=function(){2==c.job_status||1==c.job_status?(AblePlayerInstances[0].seekTo(c.last_audio_position-rewindAmountOnPause),setTimeout(function(){AblePlayerInstances[0].seekBar.setPosition(c.last_audio_position-
rewindAmountOnPause)},50)):AblePlayerInstances[0].seekTo(0)};AblePlayerInstances[0].onMediaPause=function(){0<AblePlayerInstances[0].seekBar.position-rewindAmountOnPause?AblePlayerInstances[0].seekTo(AblePlayerInstances[0].seekBar.position-rewindAmountOnPause):AblePlayerInstances[0].seekTo(0)};n.style.display="none";q(!1,"Loading transcribe..")}function w(a,c){$.ajax({url:baseURL+"LatestVersion.txt",success:function(b){c(b.split("-")[0].trim(),a)}})}function x(a,c){a>c?u(!0,a):u(!1,a)}function u(a,
c){a?($("#updated_version_bar span").html(c),$("#updated_version_bar a").attr("href","controller.php"),$("#updated_version_bar").slideDown("normal","easeInOutBack")):$("#updated_version_bar").slideUp()}function q(a,c){c=void 0===c?!1:c;a?($("body").css("overflow","none"),c&&C.html(c),loadingOv[0].style.display="block"):(loadingOv[0].style.display="none",$("body").css("overflow","auto"))}var C=$("#loadingText"),D=document.querySelector("form");loadingOv=$("#overlay");var m=$("#jobType");window.addEventListener("load",
b,!1);var k;statusTxt=$("#statusTxt");demoExpandArrow=$("#demoExpand");demoFields=$("#demoItems");demoExpandArrow.on("click",function(){demoExpandArrow.hasClass("fa-chevron-down")?(demoFields.slideUp(),demoExpandArrow.removeClass("fa-chevron-down"),demoExpandArrow.addClass("fa-chevron-right")):(demoFields.slideDown(),demoExpandArrow.removeClass("fa-chevron-right"),demoExpandArrow.addClass("fa-chevron-down"))});window.addEventListener("unload",function(){k.send("transcribe client disconnecting..")},
!1);var p=function(a,c){c=void 0===c?!1:c;statusTxt.html(a);switch(c){case !0:statusTxt.css("color",greenColor);break;case !1:statusTxt.css("color",orangeColor),$("#reconnect").on("click",function(a){b()}),$("#downloadController").on("click",function(a){window.open("controller.php","_blank")})}};$("body").niceScroll({hwacceleration:!0,smoothscroll:!0,cursorcolor:"white",cursorborder:0,scrollspeed:10,mousescrollstep:20,cursoropacitymax:.7});$.ajaxSetup({cache:!1});var n=document.getElementById("modal"),
v=document.getElementById("modalLoading");new mdc.ripple.MDCRipple(document.querySelector("#saveBtn"));new mdc.ripple.MDCRipple(document.querySelector("#suspendBtn"));new mdc.ripple.MDCRipple(document.querySelector("#discardBtn"));new mdc.ripple.MDCRipple(document.querySelector("#loadingConfirm"));new mdc.ripple.MDCRipple(document.querySelector("#pop"));new mdc.ripple.MDCRipple(document.querySelector("#logoutBtn"));jobsDT=$("#jobs-tbl");loadingConfirmBtn=$("#loadingConfirm");loadingSub=$("#modalLoading #loadingContent p i");
loadingTitle=$("#modalLoading #loadingContent h2");loadingConfirmBtn.on("click",function(){location.reload()});$(".close").on("click",function(){n.style.display="none"});$("#loadBtn").on("click",function(a){n.style.display="block";jobsDTRef.ajax.reload()});window.onclick=function(a){a.target==n&&(n.style.display="none")};jobsDT.on("init.dt",function(){$(".cTooltip").hasClass("tooltipstered")||($(".download-icon").click(function(){var a=$(this).parent().parent().attr("id");download(a)}),$(".cTooltip").tooltipster({animation:"grow",
theme:"tooltipster-punk",arrow:!0}))});jobsDTRef=jobsDT.DataTable({rowId:"file_id",ajax:"api/v1/files?dt&file_status[mul]=0,1,2",processing:!0,lengthChange:!1,pageLength:7,autoWidth:!1,columnDefs:[{targets:["_all"],className:"mdc-data-table__cell"}],columns:[{data:"job_id",render:function(a,c,b){return null!=b.file_comment?a+' <i class="material-icons mdc-button__icon job-comment cTooltip" aria-hidden="true" title=\''+htmlEncodeStr(b.file_comment)+"'>speaker_notes</i>":a}},{data:"file_author"},{data:"file_work_type"},
{data:"file_date_dict"},{data:"job_upload_date"},{data:"file_status_ref"},{data:"audio_length",render:function(a){return(new Date(1E3*a)).toISOString().substr(11,8)}}],initComplete:function(){this.api().columns().every(function(){var a=this,c=$('<select><option value=""></option></select>').appendTo($(a.footer()).empty()).on("change",function(){var c=$.fn.dataTable.util.escapeRegex($(this).val());a.search(c?"^"+c+"$":"",!0,!1).draw()});a.data().unique().sort().each(function(a,b){c.append('<option value="'+
a+'">'+a+"</option>")})})}});jobsDT.on("draw.dt",function(){$(".download-icon").click(function(){var a=$(this).parent().parent().attr("id");download(a)});$(".cTooltip").hasClass("tooltipstered")||$(".cTooltip").tooltipster({animation:"grow",theme:"tooltipster-punk",arrow:!0})});$("#jobs-tbl tbody").on("click","tr",function(){var a=jobsDTRef.row(this).id();q(!0,"Loading "+jobsDTRef.row(this).data().job_id);z(a)});D.addEventListener("submit",function(a){a.preventDefault();var c=a.submitter.id;a=new FormData;
var b=3;switch(c){case "saveBtn":b=3;break;case "suspendBtn":b=2}loadingSub.text("Saving "+currentFileData.job_id+" data");loadingTitle.text("Please wait..");loadingConfirmBtn.css("display","none");v.style.display="block";c=tinymce.get("report").getContent();var d=Math.floor(AblePlayerInstances[0].seekBar.position).toString();a.append("audio_length",Math.round(AblePlayerInstances[0].seekBar.duration));a.append("last_audio_position",d);a.append("file_status",b);a.append("job_document_html",c);a.append("file_work_type",
$("#jobType").val());a.append("typist_comments",$("#comments").val());a.append("set_role",3);c=currentFileID;t()&&$.ajax({type:"POST",url:"../api/v1/files/"+c,data:a,processData:!1,contentType:!1,success:function(a){2===b?(loadingTitle.text("Done"),loadingSub.text("Job "+currentFileData.job_id+" suspended")):3===b?(loadingTitle.text("Done"),loadingSub.text("Job "+currentFileData.job_id+" marked as complete")):(loadingTitle.text("Done"),loadingSub.text("Job "+currentFileData.job_id+" updated successfully"));
loadingConfirmBtn.css("display","")},error:function(a){alert("Error Saving Job. Please contact support - ${data}\n We will attempt to save the text contents to your clipboard if there is any");tinyMCE.activeEditor.selection.select(tinyMCE.activeEditor.getBody());tinyMCE.activeEditor.execCommand("Copy");v.style.display="none"}})});window.hidetxt=!0;$("#pop").click(function(){""!==tinymce.get("report").getContent().toString()?y():l()});$("#logoutBtn").click(function(){location.href="logout.php"});$("#discardBtn").click(function(){h()});
q(!1)});$("#jobNo").keypress(function(){document.title=$("#jobNo").val()});$(function(){$("#accord").accordion({collapsible:!0,header:"h3",heightStyle:"content",active:!1,activate:function(){$("body").getNiceScroll().resize()}})});function htmlEncodeStr(b){return b.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&lsquo;")}function switchBack(){compactViewWindow.close();$("#reconnect").click()};
