var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,c,d){a instanceof String&&(a=String(a));for(var f=a.length,e=0;e<f;e++){var g=a[e];if(c.call(d,g,e,a))return{i:e,v:g}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,d){if(a==Array.prototype||a==Object.prototype)return a;a[c]=d.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var c=0;c<a.length;++c){var d=a[c];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,c){var d=$jscomp.propertyToPolyfillSymbol[c];if(null==d)return a[c];d=a[d];return void 0!==d?d:a[c]};
$jscomp.polyfill=function(a,c,d,f){c&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,c,d,f):$jscomp.polyfillUnisolated(a,c,d,f))};$jscomp.polyfillUnisolated=function(a,c,d,f){d=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var e=a[f];if(!(e in d))return;d=d[e]}a=a[a.length-1];f=d[a];c=c(f);c!=f&&null!=c&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:c})};
$jscomp.polyfillIsolated=function(a,c,d,f){var e=a.split(".");a=1===e.length;f=e[0];f=!a&&f in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var g=0;g<e.length-1;g++){var m=e[g];if(!(m in f))return;f=f[m]}e=e[e.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?f[e]:null;c=c(d);null!=c&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:c}):c!==d&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+e,e=
$jscomp.propertyToPolyfillSymbol[e],$jscomp.defineProperty(f,e,{configurable:!0,writable:!0,value:c})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");
var g_fileName,dataTbl,currentFileID=0,currentFileData,loadingConfirmBtn,loadingSub,loadingTitle,isConnected=!1,isConnecting=!0,firstLaunch=!0,statusTxt,not_connected='<i>Couldn\'t connect to controller <u id="reconnect">reconnect?</u> <span class=\'download-controller\' id="downloadController">or download here</span></i>',connecting="<i>connecting to controller please wait...</i>",connected="<i>Connected to vScription Controller as </i>",not_running='<i>Controller not running. <u id="reconnect">reconnect?</u> <span class=\'download-controller\' id="downloadController">or download here</span></i>',
greenColor="#3e943c",orangeColor="#d34038",versionCheck="vCheck-",welcomeName="welcome-",compactViewWindow,jobsDT,jobsDTRef;
$(document).ready(function(){function a(){if(!isConnected||isConnecting)isConnecting=!0,p(connecting),h=new WebSocket("ws://localhost:8001"),h.onopen=c,h.onmessage=f,h.onerror=onerror,h.onclose=d}function c(){isConnected=!0;isConnecting=!1;p(connected,!0)}function d(){isConnecting=isConnected=!1;firstLaunch?(firstLaunch=!1,p(not_running)):p(not_connected)}function f(b){b=b.data.toString();switch(b){case "play":e(!0);break;case "pause":e(!1);break;case "rw":AblePlayerInstances[0].handleRewind();break;
case "ff":AblePlayerInstances[0].handleFastForward();break;default:b.substring(0,7)===versionCheck?w(b.substring(7),x):b.substring(0,8)}}function e(b){""!==AblePlayerInstances[0].media.src&&(b?AblePlayerInstances[0].playMedia():AblePlayerInstances[0].pauseMedia())}function g(){$.confirm({title:"Discard Form?",content:"Are you sure do you want to discard current data?",buttons:{confirm:{btnClass:"btn-red",action:function(){t();return!0}},cancel:function(){}}})}function m(){$.post("data/parts/backend_request.php",
{reqcode:203,args:JSON.stringify({fileID:currentFileID})}).done(function(b){isConnected&&(isConnecting=isConnected=!1,h.send("transcribe client disconnecting.."));0!==currentFileID&&t();AblePlayerInstances[0].pauseMedia();compactViewWindow=window.open("popup.php","modalPlayer","toolbar=yes,scrollbars=yes,resizable=yes,top=500,left=500,width=530,height=262")})}function y(){$.confirm({title:"Discard?",content:"Are you sure do you want to discard current text changes and switch to compact view?",buttons:{confirm:{btnClass:"btn-red",
action:function(){m();return!0}},cancel:function(){return!0}}})}function t(){var b=2;0===currentFileData.job_status&&(b=0);$.post("data/parts/backend_request.php",{reqcode:16,args:JSON.stringify({file_id:currentFileID,new_status:b})}).done(function(b){});r()}function r(){document.getElementById("date").value="";document.getElementById("jobNo").value="";document.getElementById("comments").value="";document.getElementById("jobType").value="";document.getElementById("authorName").value="";document.getElementById("user_field_1").value=
"";document.getElementById("user_field_2").value="";document.getElementById("user_field_3").value="";document.getElementById("report").value="";$("#date").garlic("destroy");$("#jobType").garlic("destroy");$("#jobNo").garlic("destroy");$("#comments").garlic("destroy");$("#authorName").garlic("destroy");$("#user_field_1").garlic("destroy");$("#user_field_2").garlic("destroy");$("#user_field_3").garlic("destroy");$("#report").garlic("destroy");document.title="Form";tinyMCE.activeEditor.setContent("");
currentFileID=0;z();$(".validate-form input").each(function(){$(this).removeClass("alert-validate")});$("#saveBtn").attr("disabled","disabled");$("#suspendBtn").attr("disabled","disabled");$("#discardBtn").attr("disabled","disabled");tinyMCE.activeEditor.setMode("readonly")}function z(){var b=$("#loadBtn"),q=$("#completeBtn");AblePlayerInstances[0].media.src.split("/").pop();AblePlayerInstances[0].seekTo(0);AblePlayerInstances[0].media.pause();setTimeout(function(){AblePlayerInstances[0].media.removeAttribute("src");
AblePlayerInstances[0].media.load()},300);b.removeClass("noHover");$("#loadBtn").html('<i class="fas fa-cloud-upload-alt"></i>&nbsp;Load');b.find("i").show();q.addClass("noHover");q.addClass("button");q.removeClass("button-green")}function A(b){$.get("../api/v1/files/"+b+"?tr",{}).done(function(b){b?B(b):(switchUI(!1),$.confirm({title:"Error",content:"Job doesn't exist or you don't have permission to access it.",buttons:{confirm:{btnClass:"btn-green",text:"ok"}}}))})}function C(b){var a=document.createElement("textarea");
a.innerHTML=b;return a.value}function B(b){var a=JSON.parse(b);currentFileData=a;currentFileID=a.file_id;null!==a.suspendedText&&0!==a.job_status&&(tinymce.get("report").setContent(C(a.suspendedText)),tinyMCE.activeEditor.selection.select(tinyMCE.activeEditor.getBody(),!0),tinyMCE.activeEditor.selection.collapse(!1));$("#jobNo").val(a.job_id);$("#authorName").val(a.file_author);$("#jobType").val(a.file_work_type);b=moment(a.file_date_dict).format("DD-MMM-YYYY hh:mm:ss a");$("#date").val(b);$("#comments").val(a.typist_comments);
$("#user_field_1").val(a.user_field_1);$("#user_field_2").val(a.user_field_2);$("#user_field_3").val(a.user_field_3);b=$("#loadBtn");$("#completeBtn");AblePlayerInstances[0].media.src=audioTempFolder+a.tmp_name;b.addClass("noHover");b.text(a.job_id+" Loaded");b.find("i").hide();$("#saveBtn").removeAttr("disabled");$("#suspendBtn").removeAttr("disabled");$("#discardBtn").removeAttr("disabled");tinyMCE.activeEditor.setMode("design");AblePlayer.prototype.onMediaNewSourceLoad=function(){2===a.job_status||
1===a.job_status?AblePlayerInstances[0].seekTo(a.last_audio_position-rewindAmountOnPause):AblePlayerInstances[0].seekTo(0)};AblePlayerInstances[0].onMediaPause=function(){0<AblePlayerInstances[0].seekBar.position-rewindAmountOnPause?AblePlayerInstances[0].seekTo(AblePlayerInstances[0].seekBar.position-rewindAmountOnPause):AblePlayerInstances[0].seekTo(0)};n.style.display="none"}function D(){var b=$('input[name="jobNo"]'),a=$('input[name="authorName"]'),d=$('input[name="TypistName"]'),c=$('input[name="jobType"]'),
e=$('input[name="DateDic"]'),f=$('input[name="DateTra"]'),k=!0;""==b.val().trim()&&(l(b),k=!1);""==a.val().trim()&&(l(a),k=!1);""==d.val().trim()&&(l(d),k=!1);""==c.val().trim()&&(l(c),k=!1);""==e.val().trim()&&(l(e),k=!1);""==f.val().trim()&&(l(f),k=!1);return k}function l(b){$(b).addClass("alert-validate")}function w(b,a){$.ajax({url:baseURL+"LatestVersion.txt",success:function(d){a(d.split("-")[0].trim(),b)}})}function x(b,a){b>a?u(!0,b):u(!1,b)}function u(b,a){b?($("#updated_version_bar span").html(a),
$("#updated_version_bar a").attr("href","controller.php"),$("#updated_version_bar").slideDown("normal","easeInOutBack")):$("#updated_version_bar").slideUp()}function E(){var b=new Date,a=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate();b=b.getHours()+":"+b.getMinutes()+":"+b.getSeconds();return a+" "+b}var F=document.querySelector("form");window.addEventListener("load",a,!1);var h;statusTxt=$("#statusTxt");$(document).ready(function(){$("#send").on("click",function(a){a=$("#txt").val();h.send(a)})});
window.addEventListener("unload",function(){h.send("transcribe client disconnecting..")},!1);var p=function(b,d){d=void 0===d?!1:d;statusTxt.html(b);switch(d){case !0:statusTxt.css("color",greenColor);break;case !1:statusTxt.css("color",orangeColor),$("#reconnect").on("click",function(b){a()}),$("#downloadController").on("click",function(a){window.open("controller.php","_blank")})}};$("body").niceScroll({hwacceleration:!0,smoothscroll:!0,cursorcolor:"white",cursorborder:0,scrollspeed:10,mousescrollstep:20,
cursoropacitymax:.7});$.ajaxSetup({cache:!1});var n=document.getElementById("modal"),v=document.getElementById("modalLoading");new mdc.ripple.MDCRipple(document.querySelector("#saveBtn"));new mdc.ripple.MDCRipple(document.querySelector("#suspendBtn"));new mdc.ripple.MDCRipple(document.querySelector("#discardBtn"));new mdc.ripple.MDCRipple(document.querySelector("#loadingConfirm"));new mdc.ripple.MDCRipple(document.querySelector("#pop"));new mdc.ripple.MDCRipple(document.querySelector("#logoutBtn"));
jobsDT=$("#jobs-tbl");loadingConfirmBtn=$("#loadingConfirm");loadingSub=$("#modalLoading .modal-content p i");loadingTitle=$("#modalLoading .modal-content h2");loadingConfirmBtn.on("click",function(){location.reload()});$(".close").on("click",function(){n.style.display="none"});$("#loadBtn").on("click",function(a){n.style.display="block";jobsDTRef.ajax.reload()});window.onclick=function(a){a.target==n&&(n.style.display="none")};jobsDT.on("init.dt",function(){$(".cTooltip").hasClass("tooltipstered")||
($(".download-icon").click(function(){var a=$(this).parent().parent().attr("id");download(a)}),$(".cTooltip").tooltipster({animation:"grow",theme:"tooltipster-punk",arrow:!0}))});jobsDTRef=jobsDT.DataTable({rowId:"file_id",ajax:"api/v1/files?dt&file_status[mul]=0,1,2",processing:!0,lengthChange:!1,pageLength:7,autoWidth:!1,columnDefs:[{targets:["_all"],className:"mdc-data-table__cell"}],columns:[{data:"job_id",render:function(a,d,c){return null!=c.file_comment?a+' <i class="material-icons mdc-button__icon job-comment cTooltip" aria-hidden="true" title=\''+
htmlEncodeStr(c.file_comment)+"'>speaker_notes</i>":a}},{data:"file_author"},{data:"file_work_type"},{data:"file_date_dict"},{data:"job_upload_date"},{data:"file_status_ref"},{data:"audio_length",render:function(a){return(new Date(1E3*a)).toISOString().substr(11,8)}}],initComplete:function(){this.api().columns().every(function(){var a=this,d=$('<select><option value=""></option></select>').appendTo($(a.footer()).empty()).on("change",function(){var b=$.fn.dataTable.util.escapeRegex($(this).val());
a.search(b?"^"+b+"$":"",!0,!1).draw()});a.data().unique().sort().each(function(a,b){d.append('<option value="'+a+'">'+a+"</option>")})})}});jobsDT.on("draw.dt",function(){$(".download-icon").click(function(){var a=$(this).parent().parent().attr("id");download(a)});$(".cTooltip").hasClass("tooltipstered")||$(".cTooltip").tooltipster({animation:"grow",theme:"tooltipster-punk",arrow:!0})});$("#jobs-tbl tbody").on("click","tr",function(){var a=jobsDTRef.row(this).id();A(a)});F.addEventListener("submit",
function(a){a.preventDefault();a=a.submitter.id;if(D()){var b=function(){alert("Error Saving Job. Please contact support - ${data}\n We will attempt to save the text contents to your clipboard if there is any");tinyMCE.activeEditor.selection.select(tinyMCE.activeEditor.getBody());tinyMCE.activeEditor.execCommand("Copy");r();v.style.display="none"},d=function(a){var d=tinymce.get("report").getContent(),k=Math.round(AblePlayerInstances[0].seekBar.duration),g=(new Date(1E3*k)).toISOString().substr(11,
8).toString(),h=Math.floor(AblePlayerInstances[0].seekBar.position).toString();E();c.append("report",d);c.append("reqcode",32);c.append("jobNo",a.job_id);c.append("jobLengthSecs",g);c.append("jobLengthSecsRaw",k);c.append("jobElapsedTimeSecs",h);c.append("jobAuthorName",a.file_author);c.append("jobFileName",a.origFilename);c.append("tempFilename",a.tempFilename);$fmtOrigDateDic=moment(a.file_date_dict).format("yyyy-MM-D");c.append("jobDateDic",$fmtOrigDateDic);c.append("jobType",a.file_work_type);
c.append("jobSpeakerType",a.file_speaker_type);c.append("jobComments",a.file_comment);c.append("jobStatus",f);c.append("file_id",currentFileID);fetch("data/parts/backend_request.php",{method:"POST",body:c}).then(function(a){a.text().then(function(c){a.ok?(c={mailtype:10,usertype:2},3===f&&$.post("data/parts/backend_request.php",{reqcode:80,args:JSON.stringify(c)}).done(function(a){}),r(),2===f?(loadingTitle.text("Done"),loadingSub.text("Job "+e+" suspended")):3===f?(loadingTitle.text("Done"),loadingSub.text("Job "+
e+" marked as complete")):(loadingTitle.text("Done"),loadingSub.text("Job "+e+" updated successfully")),loadingConfirmBtn.css("display","")):b()})})},c=new FormData,e=$("#jobNo").val().trim(),f=3;switch(a){case "saveBtn":f=3;break;case "suspendBtn":f=2}loadingSub.text("Saving "+e+" data");loadingTitle.text("Please wait..");loadingConfirmBtn.css("display","none");v.style.display="block";$.ajax({type:"GET",url:"../api/v1/files/"+currentFileID,processData:!1,success:function(a){0!=a.length?d(a[0]):b()},
error:function(a){$.confirm({title:"Error",content:a.responseJSON.msg,buttons:{confirm:{btnClass:"btn-red",action:function(){b();return!0}}}})}})}});window.hidetxt=!0;$("#pop").click(function(){""!==tinymce.get("report").getContent().toString()?y():m()});$("#logoutBtn").click(function(){location.href="logout.php"});$("#discardBtn").click(function(){g()});$(".validate-form input").each(function(){$(this).focus(function(){$(this).removeClass("alert-validate")})})});
$(function(){$("#dateT").datepicker({showAnim:"clip",dateFormat:"d-M-yy"})});$("#jobNo").keypress(function(){document.title=$("#jobNo").val()});$(function(){$("#accord").accordion({collapsible:!0,header:"h3",heightStyle:"content",active:!1,activate:function(){$("body").getNiceScroll().resize()}})});function htmlEncodeStr(a){return a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&lsquo;")}
function switchBack(){compactViewWindow.close();$("#reconnect").click()};
