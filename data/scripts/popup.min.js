var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(b){return b.raw=b};$jscomp.createTemplateTagFirstArgWithRaw=function(b,c){b.raw=c;return b};
var dataTbl,currentFileID=0,currentFileData,loadingConfirmBtn,loadingSub,loadingTitle,isConnected=!1,isConnecting=!0,firstLaunch=!0,statusTxt,overlay,not_connected='<i>Couldn\'t connect to controller <u id="reconnect">reconnect?</u></i>',connecting="<i>connecting to controller please wait...</i>",connected="<i>Connected to vScription Controller </i>",not_running='<i>Controller not running. <u id="reconnect">reconnect?</u></i>',greenColor="#3e943c",orangeColor="#f78d2d",versionCheck="vCheck-",backend_url=
"data/parts/backend_request.php",wsocket,jobPickerWindow;null===window.opener&&(window.location.href="/index.php");
$(document).ready(function(){function b(){if(!isConnected||isConnecting)isConnecting=!0,d(connecting),wsocket=new WebSocket("ws://localhost:8001"),wsocket.onopen=c,wsocket.onmessage=m,wsocket.onerror=onerror,wsocket.onclose=n}function c(){isConnected=!0;isConnecting=!1;d(connected);wsocket.send("Transcribe Client Connected.")}function n(){isConnecting=isConnected=!1;firstLaunch?(firstLaunch=!1,d(not_running)):d(not_connected)}function m(a){a=a.data.toString();switch(a){case "play":h(!0);break;case "pause":h(!1);
break;case "rw":AblePlayerInstances[0].handleRewind();break;case "ff":AblePlayerInstances[0].handleFastForward();break;default:a.substring(0,7)===versionCheck&&p(a.substring(7),q)}}function h(a){""!==AblePlayerInstances[0].media.src&&(a?AblePlayerInstances[0].playMedia():AblePlayerInstances[0].pauseMedia())}function k(a){var c=function(a){a=JSON.parse(a);var c=Math.floor(AblePlayerInstances[0].seekBar.position).toString();b.append("reqcode",205);b.append("file_id",currentFileID);b.append("jobID",
a.job_id);b.append("jobElapsedTimeSecs",c);b.append("jobAuthorName",a.file_author);b.append("jobFileName",a.origFilename);b.append("tempFilename",a.tempFilename);$fmtOrigDateDic=moment(a.file_date_dict).format("yyyy-MM-D");b.append("jobDateDic",$fmtOrigDateDic);b.append("jobStatus",e);fetch(backend_url,{method:"POST",body:b}).then(function(a){a.text().then(function(b){console.log(b);console.log(a);a.ok?(b={mailtype:10,usertype:2},3===e&&$.post("data/parts/backend_request.php",{reqcode:80,args:JSON.stringify(b)}).done(function(a){}),
f(),2===e?(loadingTitle.text("Done"),loadingSub.text("Job "+d+" suspended")):3===e?(loadingTitle.text("Done"),loadingSub.text("Job "+d+" marked as complete")):(loadingTitle.text("Done"),loadingSub.text("Job "+d+" updated successfully")),loadingConfirmBtn.css("display","")):(alert("Error Saving Job. Please contact support - ${data}\n We will attempt to save the text contents to your clipboard if there is any"),f(),g.style.display="none")})})},b=new FormData,d=$(".jobNo").html().trim(),e=5;a||(e=2);
loadingSub.text("Saving "+d+" data");loadingTitle.text("Please wait..");loadingConfirmBtn.css("display","none");g.style.display="block";$.post("data/parts/backend_request.php",{reqcode:11,args:JSON.stringify({file_id:currentFileID})}).done(function(a){c(a)})}function r(){var a=2;0===currentFileData.job_status&&(a=0);$.post("data/parts/backend_request.php",{reqcode:16,args:JSON.stringify({file_id:currentFileID,new_status:a})}).done(function(a){});f()}function f(){$(".title-default-text").css("display",
"inline-block");$(".title-text-holder").css("display","none");currentFileID=0;t();switchUI(!1)}function t(){AblePlayerInstances[0].media.src.split("/").pop();AblePlayerInstances[0].seekTo(0);AblePlayerInstances[0].media.pause();setTimeout(function(){AblePlayerInstances[0].media.removeAttribute("src");AblePlayerInstances[0].media.load()},300)}function u(){$.confirm({title:"Discard Form?",content:"Are you sure do you want to discard current job?",buttons:{confirm:{btnClass:"btn-red",action:function(){r();
return!0}},cancel:function(){}}})}function p(a,b){$.ajax({url:baseURL+"LatestVersion.txt",success:function(c){console.log("latestversion: "+c);b(c.split("-")[0].trim(),a)}})}function q(a,b){a>b?l(!0,a):l(!1,a)}function l(a,b){a?($("#updated_version_bar span").html(b),$("#updated_version_bar a").attr("href","controller.php"),$("#updated_version_bar").slideDown("normal","easeInOutBack")):$("#updated_version_bar").slideUp()}$(".overlay").css("display","");$(".loaded").css("display","none");new mdc.ripple.MDCRipple(document.querySelector("#saveBtn"));
new mdc.ripple.MDCRipple(document.querySelector("#suspendBtn"));new mdc.ripple.MDCRipple(document.querySelector("#discardBtn"));new mdc.ripple.MDCRipple(document.querySelector("#loadBtn"));new mdc.ripple.MDCRipple(document.querySelector("#loadingConfirm"));window.addEventListener("load",b,!1);statusTxt=$("#statusTxt");window.addEventListener("unload",postToParent,!1);var d=function(a){statusTxt.html(a);switch(a){case connected:statusTxt.css("color",greenColor);break;case not_running:case not_connected:case connecting:statusTxt.css("color",
orangeColor),$("#reconnect").on("click",function(a){b()})}};$.ajaxSetup({cache:!1});var g=document.getElementById("modalLoading");loadingConfirmBtn=$("#loadingConfirm");loadingSub=$("#modalLoading .modal-content p i");loadingTitle=$("#modalLoading .modal-content h2");loadingConfirmBtn.on("click",function(){g.style.display="none"});$("#loadBtn").on("click",function(){jobPickerWindow=window.open("job_picker.php","modalPicker","toolbar=yes,scrollbars=yes,resizable=yes,top=500,left=500,width=1000,height=500")});
$("#switchBackBtn").click(function(){postToParent()});$("#discardBtn").click(function(){u()});$("#saveBtn").click(function(){k(!0)});$("#suspendBtn").click(function(){k(!1)});$.post(backend_url,{reqcode:204}).done(function(a){console.log("session saved id is "+a);a?"0"===a?switchUI(!1):loadID(a):switchUI(!1)})});
function loadID(b){console.log("ID to load: "+b);$(".overlay").css("display","");jobPickerWindow&&jobPickerWindow.close();$.post("data/parts/backend_request.php",{reqcode:7,args:JSON.stringify({file_id:b})}).done(function(b){b?loadIntoPlayer(b):(switchUI(!1),$.confirm({title:"Error",content:"Job doesn't exist or you don't have permission to access it.",buttons:{confirm:{btnClass:"btn-green",text:"ok"}}}))})}
function loadIntoPlayer(b){var c=JSON.parse(b);currentFileData=c;currentFileID=c.file_id;$("#jobNo").html(c.job_id);$("#author").html(c.file_author);$("#jobType").html(c.file_work_type);AblePlayerInstances[0].media.src=audioTempFolder+c.tempFilename;AblePlayer.prototype.onMediaNewSourceLoad=function(){2===c.job_status||1===c.job_status?AblePlayerInstances[0].seekTo(c.last_audio_position-rewindAmountOnPause):AblePlayerInstances[0].seekTo(0);switchUI(!0)};AblePlayerInstances[0].onMediaPause=function(){0<
AblePlayerInstances[0].seekBar.position-rewindAmountOnPause?AblePlayerInstances[0].seekTo(AblePlayerInstances[0].seekBar.position-rewindAmountOnPause):AblePlayerInstances[0].seekTo(0)}}
function switchUI(b){b?($(".title-default-text").css("display","none"),$(".title-text-holder").css("display",""),$(".loaded").css("display",""),$(".not-loaded").css("display","none")):($(".title-default-text").css("display","inline-block"),$(".title-text-holder").css("display","none"),$(".loaded").css("display","none"),$(".not-loaded").css("display",""));$(".overlay").css("display","none")}function postToParent(){disconnect();null!==window.opener&&window.opener.switchBack()}
function disconnect(){if(isConnected||isConnecting)wsocket.send("transcribe client disconnecting.."),wsocket.close()};
