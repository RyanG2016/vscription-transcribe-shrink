var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var g=a[e];if(b.call(c,g,e,a))return{i:e,v:g}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var g=0;g<e.length-1;g++){var f=e[g];if(!(f in d))return;d=d[f]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+e,e=
$jscomp.propertyToPolyfillSymbol[e],$jscomp.defineProperty(d,e,{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");var g_fileName,dataTbl;$(document).tooltip({items:":not(#report_ifr,#TypistName, #jobNo, .tooltip)"});
var currentFileID=0,currentFileData,loadingConfirmBtn,loadingSub,loadingTitle,isConnected=!1,isConnecting=!0,firstLaunch=!0,statusTxt,not_connected='<i>Couldn\'t connect to controller <u id="reconnect">reconnect?</u></i> <i class="material-icons mdc-button__icon" aria-hidden="true">signal_cellular_connected_no_internet_4_bar</i>',connecting="<i>connecting to controller please wait...</i>",connected="<i>Connected to vScription Controller </i>",not_running='<i>Controller not running. <u id="reconnect">reconnect?</u></i>',
greenColor="#3e943c",orangeColor="#f78d2d",versionCheck="vCheck-";
$(document).ready(function(){function a(){if(!isConnected||isConnecting)isConnecting=!0,h(connecting),f=new WebSocket("wss://localhost:8001"),f.onopen=b,f.onmessage=d,f.onerror=onerror,f.onclose=c}function b(){isConnected=!0;isConnecting=!1;h(connected);f.send("Transcribe Client Connected.")}function c(){isConnecting=isConnected=!1;firstLaunch?(firstLaunch=!1,h(not_running)):h(not_connected)}function d(a){a=a.data.toString();switch(a){case "play":e(!0);break;case "pause":e(!1);break;case "rw":AblePlayerInstances[0].handleRewind();
break;case "ff":AblePlayerInstances[0].handleFastForward();break;default:a.substring(0,7)===versionCheck&&getLatestAppVersionNumber(a.substring(7),checkVersions)}}function e(a){""!==AblePlayerInstances[0].media.src&&(a?AblePlayerInstances[0].playMedia():AblePlayerInstances[0].pauseMedia())}var g=document.querySelector("form");window.addEventListener("load",a,!1);var f;statusTxt=$("#statusTxt");$(document).ready(function(){$("#send").on("click",function(a){a=$("#txt").val();f.send(a)})});window.addEventListener("unload",
function(){f.send("transcribe client disconnecting..")},!1);var h=function(b){statusTxt.html(b);switch(b){case connected:statusTxt.css("color",greenColor);break;case not_running:case not_connected:case connecting:statusTxt.css("color",orangeColor),$("#reconnect").on("click",function(b){a()})}};$("body").niceScroll({hwacceleration:!0,smoothscroll:!0,cursorcolor:"white",cursorborder:0,scrollspeed:10,mousescrollstep:20,cursoropacitymax:.7});$.ajaxSetup({cache:!1});var k=document.getElementById("modal"),
l=document.getElementById("modalLoading");new mdc.ripple.MDCRipple(document.querySelector("#saveBtn"));new mdc.ripple.MDCRipple(document.querySelector("#suspendBtn"));new mdc.ripple.MDCRipple(document.querySelector("#discardBtn"));new mdc.ripple.MDCRipple(document.querySelector("#loadingConfirm"));loadingConfirmBtn=$("#loadingConfirm");loadingSub=$("#modalLoading .modal-content p i");loadingTitle=$("#modalLoading .modal-content h2");loadingConfirmBtn.on("click",function(){location.reload()});$(".close").on("click",
function(){k.style.display="none"});$(".modal-content").on("animationend webkitAnimationEnd",function(){$(".textarea-holder textarea").niceScroll({hwacceleration:!0,smoothscroll:!0,cursorcolor:"#1e79be",autohidemode:!1})});$("#loadBtn").on("click",function(a){k.style.display="block";chooseJob()});window.onclick=function(a){a.target==k&&($(".textarea-holder textarea").getNiceScroll().remove(),k.style.display="none")};g.addEventListener("submit",function(a){a.preventDefault();a=a.submitter.id;if(validateForm()){var b=
function(a){a=JSON.parse(a);var b=tinymce.get("report").getContent(),f=Math.round(AblePlayerInstances[0].seekBar.duration),g=(new Date(1E3*f)).toISOString().substr(11,8).toString(),h=Math.floor(AblePlayerInstances[0].seekBar.position).toString();getCurrentDateTime();c.append("report",b);c.append("reqcode",32);c.append("jobNo",a.job_id);c.append("jobLengthSecs",g);c.append("jobLengthSecsRaw",f);c.append("jobElapsedTimeSecs",h);c.append("jobAuthorName",a.file_author);c.append("jobFileName",a.origFilename);
c.append("tempFilename",a.tempFilename);$fmtOrigDateDic=moment(a.file_date_dict).format("yyyy-MM-D");c.append("jobDateDic",$fmtOrigDateDic);c.append("jobType",a.file_work_type);c.append("jobSpeakerType",a.file_speaker_type);c.append("jobComments",a.file_comment);c.append("jobStatus",e);c.append("file_id",currentFileID);fetch("data/parts/backend_request.php",{method:"POST",body:c}).then(function(a){a.text().then(function(b){a.ok?(b={mailtype:10,usertype:2},3===e&&$.post("data/parts/backend_request.php",
{reqcode:80,args:JSON.stringify(b)}).done(function(a){}),clear(),2===e?(loadingTitle.text("Done"),loadingSub.text("Job "+d+" suspended")):3===e?(loadingTitle.text("Done"),loadingSub.text("Job "+d+" marked as complete")):(loadingTitle.text("Done"),loadingSub.text("Job "+d+" updated successfully")),loadingConfirmBtn.css("display","")):(alert("Error Saving Job. Please contact support - "+b+"\n We will attempt to save the text contents to your clipboard if there is any"),tinyMCE.activeEditor.selection.select(tinyMCE.activeEditor.getBody()),
tinyMCE.activeEditor.execCommand("Copy"),clear(),l.style.display="none")})})},c=new FormData,d=$("#jobNo").val().trim(),e=3;switch(a){case "saveBtn":e=3;break;case "suspendBtn":e=2}loadingSub.text("Saving "+d+" data");loadingTitle.text("Please wait..");loadingConfirmBtn.css("display","none");l.style.display="block";$.post("data/parts/backend_request.php",{reqcode:11,args:JSON.stringify({file_id:currentFileID})}).done(function(a){b(a)})}})});$(function(){$("#date").datepicker({showAnim:"clip",dateFormat:"d-M-yy"})});
$(function(){$("#dateT").datepicker({showAnim:"clip",dateFormat:"d-M-yy"})});$("#jobNo").keypress(function(){document.title=$("#jobNo").val()});$(function(){$("#accord").accordion({collapsible:!0,header:"h3",heightStyle:"content",active:!1,activate:function(){$("body").getNiceScroll().resize()}})});
function clearWithConfirm(){$.confirm({title:"Discard Form?",content:"Are you sure do you want to discard current data?",buttons:{confirm:{btnClass:"btn-red",action:function(){suspendAndClearForDiscard();return!0}},cancel:function(){}}})}function suspendAndClearForDiscard(){var a=2;0===currentFileData.job_status&&(a=0);$.post("data/parts/backend_request.php",{reqcode:16,args:JSON.stringify({file_id:currentFileID,new_status:a})}).done(function(a){});clear()}
function clearAfterDownload(a){$.confirm({title:"File Saved",type:"green",content:"Do you want to clear the form?",buttons:{confirm:{btnClass:"btn-red",action:function(){clear();return!0}},cancel:function(){}}})}function askForCompletePlayer(){$.confirm({title:"Unload Audio File?",content:"Do you want to unload and complete the loaded audio file?",buttons:{confirm:{btnClass:"btn-green",action:function(){completePlayer();return!0}},cancel:function(){}}})}
function clear(){document.getElementById("date").value="";document.getElementById("jobNo").value="";document.getElementById("comments").value="";document.getElementById("jobType").value="";document.getElementById("authorName").value="";document.getElementById("report").value="";$("#date").garlic("destroy");$("#jobType").garlic("destroy");$("#jobNo").garlic("destroy");$("#comments").garlic("destroy");$("#authorName").garlic("destroy");$("#report").garlic("destroy");document.title="Form";tinyMCE.activeEditor.setContent("");
currentFileID=0;completePlayer();$(".validate-form input").each(function(){hideValidate(this)});$("#saveBtn").attr("disabled","disabled");$("#suspendBtn").attr("disabled","disabled");$("#discardBtn").attr("disabled","disabled");tinyMCE.activeEditor.setMode("readonly")}
$(document).ready(function(){$("#loadBtn");$("#completeBtn");$("#completeBtn").click(function(){""===!tinymce.get("report").getContent()?validateForm():completePlayer()});$("#loadBtn").click(function(){performClick("fileLoadDiag")});window.hidetxt=!0;$("#control a").click(function(){hideShowForm()})});
function completePlayer(){var a=$("#loadBtn"),b=$("#completeBtn"),c=AblePlayerInstances[0].media.src.split("/").pop();clearTempAudio(c);try{vScriptCallback("AudioComplete",g_fileName)}catch(d){}AblePlayerInstances[0].seekTo(0);AblePlayerInstances[0].media.pause();setTimeout(function(){AblePlayerInstances[0].media.removeAttribute("src");AblePlayerInstances[0].media.load()},300);a.removeClass("noHover");$("#loadBtn").html('<i class="fas fa-cloud-upload-alt"></i>&nbsp;Load');a.find("i").show();b.addClass("noHover");
b.addClass("button");b.removeClass("button-green")}
function hideShowForm(){window.hidetxt?(window.hidetxt=!1,$("#audio-td").attr("align","center"),$("#fix-td").css("display","none"),$("#demo-td legend").css("display","none"),$("#mainlogo-td").css("display","none"),$("fieldset").slideUp(400,function(){setTimeout(function(){vScriptCallback("hide",document.getElementsByClassName("form-style-5").item(0).offsetHeight,document.getElementsByClassName("form-style-5").item(0).offsetWidth)},1200);$(".form-style-5").css("min-width","500px");$(".form-style-5").css("width",
"500px")}),$("#saveBtn").css("display","none"),$(".button-red").css("display","none"),$("#control a").html("Show Text Area")):(window.hidetxt=!0,$("#audio-td").attr("align","right"),$("#help-td").attr("align","right"),$("#fix-td").css("display",""),$("#demo-td legend").css("display",""),$("#mainlogo-td").css("display",""),$("fieldset").slideDown(400),$(".form-style-5").css("width","90%"),$(".form-style-5").css("min-width","860px"),$("#saveBtn").css("display",""),$(".button-red").css("display",""),
$("#control a").html("Hide Text Area"),vScriptCallback("show",document.getElementsByClassName("form-style-5").item(0).offsetHeight,document.getElementsByClassName("form-style-5").item(0).offsetWidth))}function performClick(a){if((a=document.getElementById(a))&&document.createEvent){var b=document.createEvent("MouseEvents");b.initEvent("click",!0,!1);a.dispatchEvent(b)}}function chooseJob(){getTransJobList(addRowHandlers)}
function jobLoadLookup(a){$.post("data/parts/backend_request.php",{reqcode:7,args:JSON.stringify({file_id:a})}).done(function(a){loadIntoPlayer(a)})}function decodeHtml(a){var b=document.createElement("textarea");b.innerHTML=a;return b.value}
function loadIntoPlayer(a){var b=JSON.parse(a);currentFileData=b;currentFileID=b.file_id;null!==b.suspendedText&&0!==b.job_status&&(tinymce.get("report").setContent(decodeHtml(b.suspendedText)),tinyMCE.activeEditor.selection.select(tinyMCE.activeEditor.getBody(),!0),tinyMCE.activeEditor.selection.collapse(!1));$(".job").val(b.job_id);$("#authorName").val(b.file_author);$("#jobType").val(b.file_work_type);a=moment(b.file_date_dict).format("D-MMM-yyyy");$("#date").val(a);$("#comments").val(b.file_comment);
a=$("#loadBtn");$("#completeBtn");AblePlayerInstances[0].media.src=audioTempFolder+b.tempFilename;a.addClass("noHover");a.text(b.job_id+" Loaded");a.find("i").hide();$("#saveBtn").removeAttr("disabled");$("#suspendBtn").removeAttr("disabled");$("#discardBtn").removeAttr("disabled");tinyMCE.activeEditor.setMode("design");a=AblePlayerInstances[0].media.play();void 0!==a&&a.then(function(a){AblePlayerInstances[0].media.pause();AblePlayerInstances[0].seekTo(0);AblePlayerInstances[0].onMediaPause=function(){0<
AblePlayerInstances[0].seekBar.position-rewindAmountOnPause?AblePlayerInstances[0].seekTo(AblePlayerInstances[0].seekBar.position-rewindAmountOnPause):AblePlayerInstances[0].seekTo(0)}}).catch(function(a){});AblePlayer.prototype.onMediaNewSourceLoad=function(){if(2===b.job_status||1===b.job_status)AblePlayerInstances[0].playMedia(),AblePlayerInstances[0].pauseMedia(),AblePlayerInstances[0].seekTo(b.last_audio_position-rewindAmountOnPause)};AblePlayerInstances[0].onMediaPause=function(){0<AblePlayerInstances[0].seekBar.position-
rewindAmountOnPause?AblePlayerInstances[0].seekTo(AblePlayerInstances[0].seekBar.position-rewindAmountOnPause):AblePlayerInstances[0].seekTo(0)};modal.style.display="none"}
function validateForm(){var a=$('input[name="jobNo"]'),b=$('input[name="authorName"]'),c=$('input[name="TypistName"]'),d=$('input[name="jobType"]'),e=$('input[name="DateDic"]'),g=$('input[name="DateTra"]'),f=!0;""==a.val().trim()&&(showValidate(a),f=!1);""==b.val().trim()&&(showValidate(b),f=!1);""==c.val().trim()&&(showValidate(c),f=!1);""==d.val().trim()&&(showValidate(d),f=!1);""==e.val().trim()&&(showValidate(e),f=!1);""==g.val().trim()&&(showValidate(g),f=!1);return f}$(".validate-form input").each(function(){$(this).focus(function(){hideValidate(this)})});
function showValidate(a){$(a).addClass("alert-validate")}function hideValidate(a){$(a).removeClass("alert-validate")}function getLatestAppVersionNumber(a,b){$.ajax({url:baseURL+"LatestVersion.txt",success:function(c){console.log("latestversion: "+c);b(c.split("-")[0].trim(),a)}})}function checkVersions(a,b){a===b?checkBrowser(!1,a):checkBrowser(!0,a)}
function checkBrowser(a,b){a?($("#updated_version_bar span").html(b),$("#updated_version_bar").slideDown("normal","easeInOutBack")):$("#updated_version_bar").slideUp()}
function getTransJobList(a){var b=$(".jobs_tbl");$.post("data/parts/backend_request.php",{reqcode:9}).done(function(c){var d=JSON.parse(c);if(d.error)return b.html(d.data),!0;b.html(d.data);new mdc.dataTable.MDCDataTable(document.querySelector(".mdc-data-table"));dataTbl=$(".jobs_tbl");dataTbl.on("init.dt",function(){$(".cTooltip").hasClass("tooltipstered")||$(".cTooltip").tooltipster({animation:"grow",theme:"tooltipster-punk",arrow:!0})});dataTbl=dataTbl.DataTable({lengthChange:!1,searching:!1,lengthMenu:!1,
pageLength:7,destroy:!0});dataTbl.on("draw",function(){$(".cTooltip").hasClass("tooltipstered")||$(".cTooltip").tooltipster({animation:"grow",theme:"tooltipster-punk",arrow:!0})});setTimeout(function(){a(d.error)},1E3)})}function addRowHandlers(a){if(!a){var b=$(".jobs_tbl").DataTable();$(".jobs_tbl tbody").on("click","tr",function(){var a=b.row(this).id();jobLoadLookup(a);$(".textarea-holder textarea").getNiceScroll().remove()})}}
function toggleClass(a,b){0<=a.className.indexOf(b)?a.className=a.className.replace(b,""):a.className+=b}function clearTempAudio(a){$.post("data/parts/backend_request.php",{reqcode:33,args:JSON.stringify({job_id:a})}).done(function(){})}function hmsToSecondsOnly(a){a=a.split(":");for(var b=0,c=1;0<a.length;)b+=c*parseInt(a.pop(),10),c*=60;return b}
function getCurrentDateTime(){var a=new Date,b=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate();a=a.getHours()+":"+a.getMinutes()+":"+a.getSeconds();return b+" "+a}function convertFormToRTF(){event.preventDefault();var a=new XMLHttpRequest;a.open("POST","formsave.php");a.onload=function(b){responseReceived(a.responseText)};var b=new FormData(document.getElementById("form"));a.send(b)}function responseReceived(a){};
