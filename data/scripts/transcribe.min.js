var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,d,b){a instanceof String&&(a=String(a));for(var f=a.length,e=0;e<f;e++){var h=a[e];if(d.call(b,h,e,a))return{i:e,v:h}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,b){if(a==Array.prototype||a==Object.prototype)return a;a[d]=b.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var d=0;d<a.length;++d){var b=a[d];if(b&&b.Math==Math)return b}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,d){var b=$jscomp.propertyToPolyfillSymbol[d];if(null==b)return a[d];b=a[b];return void 0!==b?b:a[d]};
$jscomp.polyfill=function(a,d,b,f){d&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,d,b,f):$jscomp.polyfillUnisolated(a,d,b,f))};$jscomp.polyfillUnisolated=function(a,d,b,f){b=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var e=a[f];if(!(e in b))return;b=b[e]}a=a[a.length-1];f=b[a];d=d(f);d!=f&&null!=d&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:d})};
$jscomp.polyfillIsolated=function(a,d,b,f){var e=a.split(".");a=1===e.length;f=e[0];f=!a&&f in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var h=0;h<e.length-1;h++){var l=e[h];if(!(l in f))return;f=f[l]}e=e[e.length-1];b=$jscomp.IS_SYMBOL_NATIVE&&"es6"===b?f[e]:null;d=d(b);null!=d&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:d}):d!==b&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+e,e=
$jscomp.propertyToPolyfillSymbol[e],$jscomp.defineProperty(f,e,{configurable:!0,writable:!0,value:d})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");var g_fileName,dataTbl;$(document).tooltip({items:":not(#report_ifr,#TypistName, #jobNo, .tooltip)"});
var currentFileID=0,currentFileData,loadingConfirmBtn,loadingSub,loadingTitle,isConnected=!1,isConnecting=!0,firstLaunch=!0,statusTxt,not_connected='<i>Couldn\'t connect to controller <u id="reconnect">reconnect?</u></i>',connecting="<i>connecting to controller please wait...</i>",connected="<i>Connected to vScription Controller </i>",not_running='<i>Controller not running. <u id="reconnect">reconnect?</u></i>',greenColor="#3e943c",orangeColor="#f78d2d",versionCheck="vCheck-",compactViewWindow;
$(document).ready(function(){function a(){if(!isConnected||isConnecting)isConnecting=!0,n(connecting),g=new WebSocket("ws://localhost:8001"),g.onopen=d,g.onmessage=f,g.onerror=onerror,g.onclose=b}function d(){isConnected=!0;isConnecting=!1;n(connected);g.send("Transcribe Client Connected.")}function b(){isConnecting=isConnected=!1;firstLaunch?(firstLaunch=!1,n(not_running)):n(not_connected)}function f(c){c=c.data.toString();switch(c){case "play":e(!0);break;case "pause":e(!1);break;case "rw":AblePlayerInstances[0].handleRewind();
break;case "ff":AblePlayerInstances[0].handleFastForward();break;default:c.substring(0,7)===versionCheck&&u(c.substring(7),v)}}function e(c){""!==AblePlayerInstances[0].media.src&&(c?AblePlayerInstances[0].playMedia():AblePlayerInstances[0].pauseMedia())}function h(){$.confirm({title:"Discard Form?",content:"Are you sure do you want to discard current data?",buttons:{confirm:{btnClass:"btn-red",action:function(){q();return!0}},cancel:function(){}}})}function l(){$.post("data/parts/backend_request.php",
{reqcode:203,args:JSON.stringify({fileID:currentFileID})}).done(function(c){isConnected&&(isConnecting=isConnected=!1,g.send("transcribe client disconnecting.."));0!==currentFileID&&q();AblePlayerInstances[0].pauseMedia();compactViewWindow=window.open("popup.php","modalPlayer","toolbar=yes,scrollbars=yes,resizable=yes,top=500,left=500,width=530,height=290")})}function w(){$.confirm({title:"Discard?",content:"Are you sure do you want to discard current text changes and switch to compact view?",buttons:{confirm:{btnClass:"btn-red",
action:function(){l();return!0}},cancel:function(){return!0}}})}function q(){var c=2;0===currentFileData.job_status&&(c=0);$.post("data/parts/backend_request.php",{reqcode:16,args:JSON.stringify({file_id:currentFileID,new_status:c})}).done(function(c){});p()}function p(){document.getElementById("date").value="";document.getElementById("jobNo").value="";document.getElementById("comments").value="";document.getElementById("jobType").value="";document.getElementById("authorName").value="";document.getElementById("report").value=
"";$("#date").garlic("destroy");$("#jobType").garlic("destroy");$("#jobNo").garlic("destroy");$("#comments").garlic("destroy");$("#authorName").garlic("destroy");$("#report").garlic("destroy");document.title="Form";tinyMCE.activeEditor.setContent("");currentFileID=0;x();$(".validate-form input").each(function(){$(this).removeClass("alert-validate")});$("#saveBtn").attr("disabled","disabled");$("#suspendBtn").attr("disabled","disabled");$("#discardBtn").attr("disabled","disabled");tinyMCE.activeEditor.setMode("readonly")}
function x(){var c=$("#loadBtn"),a=$("#completeBtn");AblePlayerInstances[0].media.src.split("/").pop();AblePlayerInstances[0].seekTo(0);AblePlayerInstances[0].media.pause();setTimeout(function(){AblePlayerInstances[0].media.removeAttribute("src");AblePlayerInstances[0].media.load()},300);c.removeClass("noHover");$("#loadBtn").html('<i class="fas fa-cloud-upload-alt"></i>&nbsp;Load');c.find("i").show();a.addClass("noHover");a.addClass("button");a.removeClass("button-green")}function y(c){$.post("data/parts/backend_request.php",
{reqcode:7,args:JSON.stringify({file_id:c})}).done(function(c){c?z(c):(switchUI(!1),$.confirm({title:"Error",content:"Job doesn't exist or you don't have permission to access it.",buttons:{confirm:{btnClass:"btn-green",text:"ok"}}}))})}function A(c){var a=document.createElement("textarea");a.innerHTML=c;return a.value}function z(c){var a=JSON.parse(c);currentFileData=a;currentFileID=a.file_id;null!==a.suspendedText&&0!==a.job_status&&(tinymce.get("report").setContent(A(a.suspendedText)),tinyMCE.activeEditor.selection.select(tinyMCE.activeEditor.getBody(),
!0),tinyMCE.activeEditor.selection.collapse(!1));$(".job").val(a.job_id);$("#authorName").val(a.file_author);$("#jobType").val(a.file_work_type);c=moment(a.file_date_dict).format("D-MMM-yyyy");$("#date").val(c);$("#comments").val(a.file_comment);c=$("#loadBtn");$("#completeBtn");AblePlayerInstances[0].media.src=audioTempFolder+a.tempFilename;c.addClass("noHover");c.text(a.job_id+" Loaded");c.find("i").hide();$("#saveBtn").removeAttr("disabled");$("#suspendBtn").removeAttr("disabled");$("#discardBtn").removeAttr("disabled");
tinyMCE.activeEditor.setMode("design");c=AblePlayerInstances[0].media.play();void 0!==c&&c.then(function(c){AblePlayerInstances[0].media.pause();AblePlayerInstances[0].seekTo(0);AblePlayerInstances[0].onMediaPause=function(){0<AblePlayerInstances[0].seekBar.position-rewindAmountOnPause?AblePlayerInstances[0].seekTo(AblePlayerInstances[0].seekBar.position-rewindAmountOnPause):AblePlayerInstances[0].seekTo(0)}}).catch(function(c){});AblePlayer.prototype.onMediaNewSourceLoad=function(){if(2===a.job_status||
1===a.job_status)AblePlayerInstances[0].playMedia(),AblePlayerInstances[0].pauseMedia(),AblePlayerInstances[0].seekTo(a.last_audio_position-rewindAmountOnPause)};AblePlayerInstances[0].onMediaPause=function(){0<AblePlayerInstances[0].seekBar.position-rewindAmountOnPause?AblePlayerInstances[0].seekTo(AblePlayerInstances[0].seekBar.position-rewindAmountOnPause):AblePlayerInstances[0].seekTo(0)};m.style.display="none"}function B(){var c=$('input[name="jobNo"]'),a=$('input[name="authorName"]'),b=$('input[name="TypistName"]'),
d=$('input[name="jobType"]'),e=$('input[name="DateDic"]'),f=$('input[name="DateTra"]'),g=!0;""==c.val().trim()&&(k(c),g=!1);""==a.val().trim()&&(k(a),g=!1);""==b.val().trim()&&(k(b),g=!1);""==d.val().trim()&&(k(d),g=!1);""==e.val().trim()&&(k(e),g=!1);""==f.val().trim()&&(k(f),g=!1);return g}function k(c){$(c).addClass("alert-validate")}function u(c,a){$.ajax({url:baseURL+"LatestVersion.txt",success:function(b){a(b.split("-")[0].trim(),c)}})}function v(a,b){a>b?r(!0,a):r(!1,a)}function r(a,b){a?($("#updated_version_bar span").html(b),
$("#updated_version_bar a").attr("href","controller.php"),$("#updated_version_bar").slideDown("normal","easeInOutBack")):$("#updated_version_bar").slideUp()}function C(a){var c=$(".jobs_tbl");$.post("data/parts/backend_request.php",{reqcode:9}).done(function(b){var d=JSON.parse(b);if(d.error)return c.html(d.data),!0;c.html(d.data);new mdc.dataTable.MDCDataTable(document.querySelector(".mdc-data-table"));dataTbl=$(".jobs_tbl");dataTbl.on("init.dt",function(){$(".cTooltip").hasClass("tooltipstered")||
$(".cTooltip").tooltipster({animation:"grow",theme:"tooltipster-punk",arrow:!0})});dataTbl=dataTbl.DataTable({lengthChange:!1,searching:!1,lengthMenu:!1,pageLength:7,destroy:!0});dataTbl.on("draw",function(){$(".cTooltip").hasClass("tooltipstered")||$(".cTooltip").tooltipster({animation:"grow",theme:"tooltipster-punk",arrow:!0})});setTimeout(function(){a(d.error)},1E3)})}function D(a){if(!a){var c=$(".jobs_tbl").DataTable();$(".jobs_tbl tbody").on("click","tr",function(){var a=c.row(this).id();y(a)})}}
function E(){var a=new Date,b=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate();a=a.getHours()+":"+a.getMinutes()+":"+a.getSeconds();return b+" "+a}var F=document.querySelector("form");window.addEventListener("load",a,!1);var g;statusTxt=$("#statusTxt");$(document).ready(function(){$("#send").on("click",function(a){a=$("#txt").val();g.send(a)})});window.addEventListener("unload",function(){g.send("transcribe client disconnecting..")},!1);var n=function(c){statusTxt.html(c);switch(c){case connected:statusTxt.css("color",
greenColor);break;case not_running:case not_connected:case connecting:statusTxt.css("color",orangeColor),$("#reconnect").on("click",function(c){a()})}};$("body").niceScroll({hwacceleration:!0,smoothscroll:!0,cursorcolor:"white",cursorborder:0,scrollspeed:10,mousescrollstep:20,cursoropacitymax:.7});$.ajaxSetup({cache:!1});var m=document.getElementById("modal"),t=document.getElementById("modalLoading");new mdc.ripple.MDCRipple(document.querySelector("#saveBtn"));new mdc.ripple.MDCRipple(document.querySelector("#suspendBtn"));
new mdc.ripple.MDCRipple(document.querySelector("#discardBtn"));new mdc.ripple.MDCRipple(document.querySelector("#loadingConfirm"));loadingConfirmBtn=$("#loadingConfirm");loadingSub=$("#modalLoading .modal-content p i");loadingTitle=$("#modalLoading .modal-content h2");loadingConfirmBtn.on("click",function(){location.reload()});$(".close").on("click",function(){m.style.display="none"});$("#loadBtn").on("click",function(a){m.style.display="block";C(D)});window.onclick=function(a){a.target==m&&(m.style.display=
"none")};F.addEventListener("submit",function(a){a.preventDefault();a=a.submitter.id;if(B()){var c=function(a){a=JSON.parse(a);var c=tinymce.get("report").getContent(),f=Math.round(AblePlayerInstances[0].seekBar.duration),g=(new Date(1E3*f)).toISOString().substr(11,8).toString(),h=Math.floor(AblePlayerInstances[0].seekBar.position).toString();E();b.append("report",c);b.append("reqcode",32);b.append("jobNo",a.job_id);b.append("jobLengthSecs",g);b.append("jobLengthSecsRaw",f);b.append("jobElapsedTimeSecs",
h);b.append("jobAuthorName",a.file_author);b.append("jobFileName",a.origFilename);b.append("tempFilename",a.tempFilename);$fmtOrigDateDic=moment(a.file_date_dict).format("yyyy-MM-D");b.append("jobDateDic",$fmtOrigDateDic);b.append("jobType",a.file_work_type);b.append("jobSpeakerType",a.file_speaker_type);b.append("jobComments",a.file_comment);b.append("jobStatus",e);b.append("file_id",currentFileID);fetch("data/parts/backend_request.php",{method:"POST",body:b}).then(function(a){a.text().then(function(b){a.ok?
(b={mailtype:10,usertype:2},3===e&&$.post("data/parts/backend_request.php",{reqcode:80,args:JSON.stringify(b)}).done(function(a){}),p(),2===e?(loadingTitle.text("Done"),loadingSub.text("Job "+d+" suspended")):3===e?(loadingTitle.text("Done"),loadingSub.text("Job "+d+" marked as complete")):(loadingTitle.text("Done"),loadingSub.text("Job "+d+" updated successfully")),loadingConfirmBtn.css("display","")):(alert("Error Saving Job. Please contact support - ${data}\n We will attempt to save the text contents to your clipboard if there is any"),
tinyMCE.activeEditor.selection.select(tinyMCE.activeEditor.getBody()),tinyMCE.activeEditor.execCommand("Copy"),p(),t.style.display="none")})})},b=new FormData,d=$("#jobNo").val().trim(),e=3;switch(a){case "saveBtn":e=3;break;case "suspendBtn":e=2}loadingSub.text("Saving "+d+" data");loadingTitle.text("Please wait..");loadingConfirmBtn.css("display","none");t.style.display="block";$.post("data/parts/backend_request.php",{reqcode:11,args:JSON.stringify({file_id:currentFileID})}).done(function(a){c(a)})}});
window.hidetxt=!0;$("#pop").click(function(){""!==tinymce.get("report").getContent().toString()?w():l()});$("#discardBtn").click(function(){h()});$(".validate-form input").each(function(){$(this).focus(function(){$(this).removeClass("alert-validate")})})});$(function(){$("#date").datepicker({showAnim:"clip",dateFormat:"d-M-yy"})});$(function(){$("#dateT").datepicker({showAnim:"clip",dateFormat:"d-M-yy"})});$("#jobNo").keypress(function(){document.title=$("#jobNo").val()});
$(function(){$("#accord").accordion({collapsible:!0,header:"h3",heightStyle:"content",active:!1,activate:function(){$("body").getNiceScroll().resize()}})});function switchBack(){compactViewWindow.close();$("#reconnect").click()};
